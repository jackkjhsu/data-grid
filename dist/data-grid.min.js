function W(n){return n.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(t,e)=>e.toUpperCase())}function V(n){if(n==="true")return!0;if(n==="false")return!1;if(n===""||n==="null")return null;if(n===Number(n).toString())return Number(n);if(n&&["[","{"].includes(n.substring(0,1)))try{let t=n;return t.indexOf('"')===-1&&(t=t.replace(/'/g,'"')),JSON.parse(decodeURIComponent(t))}catch{return console.error(`Failed to parse ${n}`),{}}return n}var Ot=["scroll","wheel","touchstart","touchmove","touchenter","touchend","touchleave","mouseout","mouseleave","mouseup","mousedown","mousemove","mouseenter","mousewheel","mouseover"];function mt(n){return Ot.includes(n)?{passive:!0}:{}}function $(n,t){return n.getAttribute(t)}function U(n,t){return n.hasAttribute(t)}function c(n,t,e="",i=!1){i&&U(n,t)||n.setAttribute(t,`${e}`)}function L(n,t){U(n,t)&&n.removeAttribute(t)}function A(n,t,e){n.addEventListener(t,e,mt(t))}function O(n,t,e){n.removeEventListener(t,e,mt(t))}function y(n,t,e={},i=!1){let o={};i&&(o.bubbles=!0),e&&(o.detail=e),n.dispatchEvent(new CustomEvent(t,o))}function T(n,t){return n.classList.contains(t)}function E(n,t){n.classList.add(...t.split(" "))}function F(n,t){n.classList.remove(...t.split(" "))}function bt(n,t){n.classList.toggle(t)}function I(n,t=document){return n instanceof HTMLElement?n:t.querySelector(n)}function zt(n,t=document){return Array.from(t.querySelectorAll(n))}function N(n,t){return I(t,n)}function g(n,t){return zt(t,n)}function x(n,t=null){let e=document.createElement(n);return t&&t.appendChild(e),e}function vt(n,t){t.parentNode.insertBefore(n,t.nextSibling)}var Y=class extends HTMLElement{constructor(t={}){super(),this.options=Object.assign({},this.defaultOptions,this.normalizedDataset,t),this.log("constructor"),this.fireEvents=!0,this._ready(),this.log("ready")}get defaultOptions(){return{}}getOption(t){return this.options[t]}setOption(t,e){c(this,`data-${t}`,e)}toggleOption(t){c(this,`data-${t}`,!this.getOption(t))}get normalizedDataset(){let t=this.dataset.config?JSON.parse(this.dataset.config):{},e={...this.dataset};for(let i in e)i!=="config"&&(e[i]=V(e[i]));return Object.assign(e,t),e}static template(){return""}_ready(){}log(t){this.options.debug&&console.log(`[${$(this,"id")}] ${t}`)}handleEvent(t){this[`on${t.type}`]&&this[`on${t.type}`](t)}_connected(){}connectedCallback(){setTimeout(()=>{this.log("connectedCallback");let t=document.createElement("template");t.innerHTML=this.constructor.template(),this.appendChild(t.content.cloneNode(!0)),this._connected(),y(this,"connected")},0)}_disconnected(){}disconnectedCallback(){this.log("disconnectedCallback"),this._disconnected(),y(this,"disconnected")}get transformAttributes(){return{}}attributeChangedCallback(t,e,i){if(e===i)return;this.log(`attributeChangedCallback: ${t}`);let o=!1,r=this.transformAttributes[t]??V,s=t;s.indexOf("data-")===0&&(s=s.slice(5),o=!0),s=W(s),o?this.options[s]=r(i):this[s]=r(i),this.fireEvents&&this[`${s}Changed`]&&this[`${s}Changed`]()}},yt=Y;function J(n,t,e,i=!1){let o=document.createElement("option");o.value=`${t}`,i&&(o.selected=!0),o.label=e,n.appendChild(o)}function Z(n,t={}){for(let e of Object.keys(t))if(Array.isArray(t[e]))for(let i of Object.keys(t[e]))n.searchParams.append(isNaN(i)?`${e}[${i}]`:e,t[e][i]);else n.searchParams.append(e,t[e])}function X(n){if(typeof n=="string"){if(n[0]==="["){let t=n;return t.indexOf('"')===-1&&(t=t.replace(/'/g,'"')),JSON.parse(t)}return n.split(",")}return Array.isArray(n)?n:(console.error("Invalid array",n),[])}function Q(n){let t=n.getBoundingClientRect(),e=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+i,left:t.left+e}}function M(n,t){return n.replace(/\{([^}]+)?\}/g,(e,i)=>t[i])}var tt;function _(n,t=document.body,e=!1){let i=window.getComputedStyle(t||document.createElement("div")),o=i.getPropertyValue("font-weight")||"normal",r=i.getPropertyValue("font-size")||"1rem",s=i.getPropertyValue("font-family")||"Arial",l=0;if(e){let u=i.getPropertyValue("padding-left")||"0",h=i.getPropertyValue("padding-right")||"0";l=Number.parseInt(u)+Number.parseInt(h)}tt||(tt=document.createElement("canvas"));let a=tt.getContext("2d");a.font=`${o} ${r} ${s}`;let d=a.measureText(n);return Number.parseInt(d.width)+l}function G(n){return Math.random().toString(36).replace("0.",n||"")}function q(n,t=300){let e=null;return(...i)=>{clearTimeout(e),e=setTimeout(()=>{e=null,n(...i)},t)}}var B={},C={itemsPerPage:"Items per page",gotoPage:"Go to page",gotoFirstPage:"Go to first page",gotoPrevPage:"Go to previous page",gotoNextPage:"Go to next page",gotoLastPage:"Go to last page",of:"of",items:"items",resizeColumn:"Resize column",noData:"No data",areYouSure:"Are you sure?",networkError:"Network response error"};function xt(n,t){t.width&&c(n,"width",t.width),t.class&&E(n,t.class),t.hidden&&(c(n,"hidden",""),t.responsiveHidden&&E(n,"dg-responsive-hidden"))}var et=class n extends yt{_filterSelector="[id^=dg-filter]";_excludedKeys=[37,39,38,40,45,36,35,33,34,27,20,16,17,91,92,18,93,144,231,"ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Insert","Home","End","PageUp","PageDown","Escape","CapsLock","Shift","Control","Meta","Alt","ContextMenu","NumLock","Unidentified"];_ready(){c(this,"id",this.options.id??G("el-"),!0),this.data=[],this.originalData,this.options=this.options||this.defaultOptions,this.fireEvents=!1,this.page=this.options.defaultPage||1,this.pages=0,this.meta,this.plugins={};for(let[t,e]of Object.entries(B))this.plugins[t]=new e(this);for(let t of n.observedAttributes)t.indexOf("data-")===0&&c(this,t,this.options[W(t.slice(5))])}static template(){return`
<table role="grid" >
    <thead role="rowgroup">
        <tr role="row" aria-rowindex="1" class="dg-head-columns"><th><!-- keep for getTextWidth --></th></tr>
        <tr role="row" aria-rowindex="2" class="dg-head-filters"></tr>
    </thead>
    <tbody role="rowgroup" data-empty="${C.noData}"></tbody>
    <tfoot role="rowgroup" hidden>
        <tr role="row" aria-rowindex="1">
            <td role="gridcell">
            <div class="dg-footer">
                <div class="dg-page-nav">
                  <select class="dg-select-per-page" aria-label="${C.itemsPerPage}"></select>
                </div>
                <div class="dg-pagination">
                  <button type="button" class="dg-btn-first dg-rotate" title="${C.gotoFirstPage}" aria-label="${C.gotoFirstPage}" disabled>
                    <i class="dg-skip-icon"></i>
                  </button>
                  <button type="button" class="dg-btn-prev dg-rotate" title="${C.gotoPrevPage}" aria-label="${C.gotoPrevPage}" disabled>
                    <i class="dg-nav-icon"></i>
                  </button>
                  <input type="number" class="dg-input-page" min="1" step="1" value="1" aria-label="${C.gotoPage}">
                  <button type="button" class="dg-btn-next" title="${C.gotoNextPage}" aria-label="${C.gotoNextPage}" disabled>
                    <i class="dg-nav-icon"></i>
                  </button>
                  <button type="button" class="dg-btn-last" title="${C.gotoLastPage}" aria-label="${C.gotoLastPage}" disabled>
                    <i class="dg-skip-icon"></i>
                  </button>
                </div>
                <div class="dg-meta">
                  <span class="dg-low">0</span> - <span class="dg-high">0</span> ${C.of} <span class="dg-total">0</span> ${C.items}
                </div>
            </div>
            </td>
        </tr>
    </tfoot>
    <ul class="dg-menu" hidden></ul>
</table>
`}get labels(){return C}static getLabels(){return C}static setLabels(t){C=Object.assign(C,t)}get defaultColumn(){return{field:"",title:"",width:0,class:"",attr:"",hidden:!1,editable:!1,noSort:!1,responsive:1,responsiveHidden:!1,format:"",transform:"",filterType:"text",firstFilterOption:{value:"",text:""}}}get defaultOptions(){return{id:null,url:null,perPage:10,debug:!1,filter:!1,menu:!1,sort:!1,server:!1,serverParams:{start:"start",length:"length",search:"search",sort:"sort",sortDir:"sortDir",dataKey:"data",metaKey:"meta",metaTotalKey:"total",metaFilteredKey:"filtered",optionsKey:"options",paramsKey:"params"},defaultSort:"",reorder:!1,dir:"ltr",perPageValues:[10,25,50,100,250],hidePerPage:!1,columns:[],actions:[],collapseActions:!1,selectable:!1,selectVisibleOnly:!0,defaultPage:1,resizable:!1,autosize:!0,expand:!1,autoheight:!0,autohidePager:!1,responsive:!1,responsiveToggle:!0,filterOnEnter:!0,filterKeypressDelay:500,spinnerClass:"",saveState:!1,errorMessage:""}}get isInit(){return this.classList.contains("dg-initialized")}get hasDataError(){return this.classList.contains("dg-network-error")}static registerPlugins(t){B=t}static unregisterPlugins(t=null){t===null?B={}:delete B[t]}static registeredPlugins(){return B}convertColumns(t){let e=[];if(typeof t=="object"&&!Array.isArray(t))for(let i of Object.keys(t)){let o=Object.assign({},this.defaultColumn);o.title=t[i],o.field=i,e.push(o)}else for(let i of t){let o=Object.assign({},this.defaultColumn);typeof i=="string"?(o.title=i,o.field=i):typeof i=="object"?(o=Object.assign(o,i),o.field||console.error("Invalid column definition",i),o.title||(o.title=o.field)):console.error("Column definition must be a string or an object"),e.push(o)}return e}static get observedAttributes(){return["page","data-filter","data-sort","data-debug","data-reorder","data-menu","data-selectable","data-url","data-per-page","data-responsive"]}get transformAttributes(){return{columns:t=>this.convertColumns(X(t)),actions:t=>X(t),defaultPage:t=>Number.parseInt(t),perPage:t=>Number.parseInt(t)}}get thead(){return I("thead",this)}get tbody(){return I("tbody",this)}get tfoot(){return I("tfoot",this)}get page(){return Number.parseInt(this.getAttribute("page"))}set page(t){c(this,"page",this.constrainPageValue(t))}urlChanged(t=!1){t&&!this.isInit||(this.reconfig(),this.loadData().then(()=>{this.configureUi()}))}reconfig(){let t=this.options.columns;this.options.columns=[],this.configureUi(),this.options.columns=t}constrainPageValue(t){let e=t;return this.pages<e&&(e=this.pages),(e<1||!e)&&(e=1),e}fixPage(){this.pages=this.totalPages(),this.page=this.constrainPageValue(this.page),c(this.inputPage,"max",this.pages),this.inputPage.value=`${this.page}`,this.inputPage.disabled=this.pages<2}pageChanged(){this.reload()}responsiveChanged(){this.plugins.ResponsiveGrid&&(this.options.responsive?this.plugins.ResponsiveGrid.observe():this.plugins.ResponsiveGrid.unobserve())}menuChanged(){this.renderHeader()}changePerPage(){this.options.perPage=Number.parseInt(this.selectPerPage.options[this.selectPerPage.selectedIndex].value),this.perPageChanged()}perPageChanged(){this.options.perPage!==Number.parseInt(this.selectPerPage.options[this.selectPerPage.selectedIndex].value)&&this.perPageValuesChanged();let t=this.page;for(;t>1&&this.page*this.options.perPage>this.totalRecords();)t--;t!==this.page?this.page=t:this.reload(()=>{(!this.plugins.FixedHeight||!this.plugins.FixedHeight.hasFixedHeight)&&this.selectPerPage.scrollIntoView()})}dirChanged(){c(this,"dir",this.options.dir)}defaultSortChanged(){this.sortChanged()}perPageValuesChanged(){if(this.selectPerPage){for(;this.selectPerPage.lastChild;)this.selectPerPage.removeChild(this.selectPerPage.lastChild);for(let t of this.options.perPageValues)J(this.selectPerPage,t,t,t===this.options.perPage)}}_connected(){this.table=this.querySelector("table"),this.btnFirst=this.querySelector(".dg-btn-first"),this.btnPrev=this.querySelector(".dg-btn-prev"),this.btnNext=this.querySelector(".dg-btn-next"),this.btnLast=this.querySelector(".dg-btn-last"),this.selectPerPage=this.querySelector(".dg-select-per-page"),this.inputPage=this.querySelector(".dg-input-page"),this.getFirst=this.getFirst.bind(this),this.getPrev=this.getPrev.bind(this),this.getNext=this.getNext.bind(this),this.getLast=this.getLast.bind(this),this.changePerPage=this.changePerPage.bind(this),this.gotoPage=this.gotoPage.bind(this),this.btnFirst.addEventListener("click",this.getFirst),this.btnPrev.addEventListener("click",this.getPrev),this.btnNext.addEventListener("click",this.getNext),this.btnLast.addEventListener("click",this.getLast),this.selectPerPage.addEventListener("change",this.changePerPage),this.selectPerPage.toggleAttribute("hidden",this.options.hidePerPage),this.inputPage.addEventListener("input",this.gotoPage);for(let t of Object.values(this.plugins))t.connected();this.dirChanged(),this.perPageValuesChanged(),this.loadData().finally(()=>{this.configureUi(),this.sortChanged(),this.classList.add("dg-initialized"),this.filterChanged(),this.reorderChanged(),this.dirChanged(),this.perPageValuesChanged(),this.pageChanged(),this.fireEvents=!0,this.log("initialized")})}_disconnected(){this.btnFirst?.removeEventListener("click",this.getFirst),this.btnPrev?.removeEventListener("click",this.getPrev),this.btnNext?.removeEventListener("click",this.getNext),this.btnLast?.removeEventListener("click",this.getLast),this.selectPerPage?.removeEventListener("change",this.changePerPage),this.inputPage?.removeEventListener("input",this.gotoPage);for(let t of Object.values(this.plugins))t.disconnected()}getCol(t){let e=null;for(let i of this.options.columns)i.field===t&&(e=i);return e}getColProp(t,e){let i=this.getCol(t);return i?i[e]:null}setColProp(t,e,i){let o=this.getCol(t);o&&(o[e]=i)}visibleColumns(){return this.options.columns.filter(t=>!t.hidden)}hiddenColumns(){return this.options.columns.filter(t=>t.hidden===!0)}showColumn(t,e=!0){this.setColProp(t,"hidden",!1),e&&this.renderTable(),y(this,"columnVisibility",{col:t,visibility:"visible"})}hideColumn(t,e=!0){this.setColProp(t,"hidden",!0),e&&this.renderTable(),y(this,"columnVisibility",{col:t,visibility:"hidden"})}startColIndex(){let t=1;return this.options.selectable&&this.plugins.SelectableRows&&t++,this.options.responsive&&this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.hasHiddenColumns()&&t++,t}isSticky(){return this.hasAttribute("sticky")}columnsLength(t=!1){let e=0;for(let i of this.options.columns)t&&i.hidden||i.attr||e++;return this.options.selectable&&this.plugins.SelectableRows&&e++,this.options.actions.length&&this.plugins.RowActions&&e++,this.options.responsive&&this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.hasHiddenColumns()&&e++,e}configureUi(){if(this.table.style.visibility="hidden",this.renderTable(),this.options.responsive&&this.plugins.ResponsiveGrid||(this.table.style.visibility="visible"),!this.rowHeight){let t=N(this,"tbody tr")||N(this,"table tr");t&&(this.rowHeight=t.offsetHeight)}this.fixPage()}filterChanged(){let t=this.querySelector("thead tr.dg-head-filters");this.options.filter?L(t,"hidden"):(this.clearFilters(),c(t,"hidden",""))}reorderChanged(){let t=g(this,"thead tr.dg-head-columns th");for(let e of t)e.classList.contains("dg-selectable")||e.classList.contains("dg-actions")||(this.options.reorder&&this.plugins.DraggableHeaders?e.draggable=!0:e.removeAttribute("draggable"))}sortChanged(){this.log("toggle sort");let t=g(this,"thead tr.dg-head-columns th");for(let e of t){let i=e.getAttribute("field");if(e.classList.contains("dg-not-sortable")||!this.fireEvents&&i===this.options.defaultSort)return;this.options.sort&&!this.getColProp(i,"noSort")?c(e,"aria-sort","none"):L(e,"aria-sort")}}selectableChanged(){this.renderTable()}addRow(t){Array.isArray(this.originalData)&&(this.log("add row"),this.originalData.push(t),this.data=this.originalData.slice(),this.sortData())}removeRow(t=null,e=null){if(!Array.isArray(this.originalData))return;let i=t,o=e;o===null&&(o=this.options.columns[0].field),i===null&&(i=this.originalData[this.originalData.length-1][o]),this.log(`remove row ${o}:${i}`);for(let r=0;r<this.originalData.length;r++)if(this.originalData[r][o]===i){this.originalData.splice(r,1);break}this.data=this.originalData.slice(),this.sortData()}getSelection(t=null){return this.plugins.SelectableRows?this.plugins.SelectableRows.getSelection(t):[]}getData(){return this.originalData}clearData(){this.data.length!==0&&(this.data=this.originalData=[],this.renderBody())}preload(t){let e=this.options.serverParams.metaKey,i=this.options.serverParams.dataKey;t?.[e]&&(this.meta=t[e]),t?.[i]&&(this.data=this.originalData=t[i])}refresh(t=null){return this.data=this.originalData=[],this.reload(t)}reload(t=null){this.log("reload");let e=!this.originalData?.length;this.fixPage(),this.loadData().finally(()=>{this.hasDataError||(this.options.server||e?this.renderBody():this.paginate(),t&&t())})}loadData(){let t=()=>!this.data.length&&this.classList.add("dg-empty"),e=this.tbody;return(this.meta||this.originalData||this.isInit)&&(!this.options.server||this.options.server&&!this.fireEvents)?(this.log("skip loadData"),t(),new Promise(i=>{i()})):(this.log("loadData"),this.loading=!0,this.classList.add("dg-loading"),this.classList.remove("dg-empty","dg-network-error"),this.fetchData().then(i=>{if(Array.isArray(i))this.data=i;else{if(!i[this.options.serverParams.dataKey]){console.error("Invalid response, it should contain a data key with an array or be a plain array",i),this.options.url=null;return}this.options=Object.assign(this.options,i[this.options.serverParams.optionsKey]??{}),this.meta=i[this.options.serverParams.metaKey]??{},this.data=i[this.options.serverParams.dataKey]}this.originalData=this.data.slice(),this.fixPage(),this.options.columns.length===0&&this.originalData.length?this.options.columns=this.convertColumns(Object.keys(this.originalData[0])):this.options.columns=this.convertColumns(this.options.columns)}).catch(i=>{this.log(i),e.setAttribute("data-empty",this.options.errorMessage||i.message?.replace(/^\s+|\r\n|\n|\r$/g,"")||C.networkError),this.classList.add("dg-empty","dg-network-error"),y(this,"loadDataFailed",i)}).finally(()=>{t(),!this.hasDataError&&e.getAttribute("data-empty")!==this.labels.noData&&e.setAttribute("data-empty",this.labels.noData),this.classList.remove("dg-loading"),c(this.table,"aria-rowcount",this.data.length),this.loading=!1}))}getFirst(){this.loading||(this.page=1)}getLast(){this.loading||(this.page=this.pages)}getPrev(){this.loading||(this.page=this.page-1)}getNext(){this.loading||(this.page=this.page+1)}gotoPage(t){if(t.type==="keypress"){let e=t.keyCode||t.key;if(e===13||e==="Enter")t.preventDefault();else return}this.page=Number.parseInt(this.inputPage.value)}getSort(){let t=this.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']");return t?t.getAttribute("field"):this.options.defaultSort}getSortDir(){let t=this.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']");return t&&t.getAttribute("aria-sort")||""}getFilters(){let t=[],e=g(this,this._filterSelector);for(let i of e)t[i.dataset.name]=i.value;return t}clearFilters(){let t=g(this,this._filterSelector);for(let e of t)e.value="";this.filterData()}filterData(){if(this.log("filter data"),this.page=1,this.options.server)this.reload();else{this.data=this.originalData?.slice()??[];let t=g(this,this._filterSelector);for(let i of t){let o=i.value;if(o){let r=i.dataset.name;this.data=this.data.filter(s=>`${s[r]}`.toLowerCase().indexOf(o.toLowerCase())!==-1)}}this.pageChanged();let e=this.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']");this.options.sort&&e?this.sortData():this.renderBody()}}sortData(t=null){this.log("sort data");let e=t;if(e&&this.getColProp(e.getAttribute("field"),"noSort")){this.log("sorting prevented because column is not sortable");return}if(this.plugins.ColumnResizer?.isResizing){this.log("sorting prevented because resizing");return}if(this.loading){this.log("sorting prevented because loading");return}if(e!==null){let i=r=>["dg-selectable","dg-actions","dg-responsive-toggle"].includes(r),o=g(this,"thead tr:first-child th");for(let r of o)[...r.classList].some(i)||r!==e&&r.setAttribute("aria-sort","none");!e.hasAttribute("aria-sort")||e.getAttribute("aria-sort")==="none"?e.setAttribute("aria-sort","ascending"):e.getAttribute("aria-sort")==="ascending"?e.setAttribute("aria-sort","descending"):e.getAttribute("aria-sort")==="descending"&&e.setAttribute("aria-sort","none")}else e=this.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']");if(this.options.server)this.loadData().finally(()=>{this.renderBody()});else{let i=e?e.getAttribute("aria-sort"):"none";if(i==="none"){let o=[];this.originalData?.some(r=>(this.data.some(s=>JSON.stringify(r)===JSON.stringify(s)?(o.push(s),!0):!1),o.length===this.data.length)),this.data=o}else{let o=e.getAttribute("field");this.data.sort((r,s)=>{if(!isNaN(r[o])&&!isNaN(s[o]))return i==="ascending"?r[o]-s[o]:s[o]-r[o];let l=i==="ascending"?r[o].toUpperCase():s[o].toUpperCase(),a=i==="ascending"?s[o].toUpperCase():r[o].toUpperCase();switch(!0){case l>a:return 1;case l<a:return-1;case l===a:return 0}})}this.renderBody()}}_sort(t,e){let i=this.querySelector(`.dg-head-columns th[field=${t}]`),o=e==="ascending"?"none":e==="descending"?"ascending":"descending";i?.setAttribute("aria-sort",o),this.sortData(i)}sortAsc=t=>this._sort(t,"ascending");sortDesc=t=>this._sort(t,"descending");sortNone=t=>this._sort(t,"none");fetchData(){if(!this.options.url)return new Promise((o,r)=>r("No url set"));let t=window.location.href;t.split("/").pop().includes(".")||(t+=t.endsWith("/")?"":"/");let e=new URL(this.options.url,t),i={r:Date.now()};return this.options.server&&(i[this.options.serverParams.start]=this.page-1,i[this.options.serverParams.length]=this.options.perPage,this.options.filter&&(i[this.options.serverParams.search]=this.getFilters()),i[this.options.serverParams.sort]=this.getSort()||"",i[this.options.serverParams.sortDir]=this.getSortDir(),this.meta?.[this.options.serverParams.paramsKey]&&(i=Object.assign(i,this.meta[this.options.serverParams.paramsKey]))),Z(e,i),fetch(e).then(o=>{let r=new Error(o.statusText||C.networkError);if(!o.ok)throw r.response=o,r;return o.clone().json().catch(s=>{let l=s;throw this.options.debug||(l=r),l.response=o,l})})}renderTable(){this.log("render table"),this.options.menu&&this.plugins.ContextMenu&&this.plugins.ContextMenu.createMenu();let t;this.renderHeader(),this.options.defaultSort&&(t=this.querySelector(`thead tr.dg-head-columns th[field="${this.options.defaultSort}"]`)),t?this.sortData(t):this.renderBody(),this.renderFooter()}renderHeader(){this.log("render header");let t=this.thead;this.createColumnHeaders(t),this.createColumnFilters(t),this.options.resizable&&this.plugins.ColumnResizer&&this.plugins.ColumnResizer.renderResizer(C.resizeColumn),y(this,"headerRendered")}renderFooter(){this.log("render footer");let t=this.tfoot,e=t.querySelector("td");t.removeAttribute("hidden"),c(e,"colspan",this.columnsLength(!0)),t.style.display=""}createColumnHeaders(t){let e=this.clientWidth,i=Math.round(e/this.columnsLength(!0)*2),o=0,r;r=x("tr"),this.headerRow=r,r.setAttribute("role","row"),r.setAttribute("aria-rowindex","1"),r.setAttribute("class","dg-head-columns");let s=t.querySelector("tr.dg-head-columns th");s||(s=x("th"),t.querySelector("tr").appendChild(s)),this.options.selectable&&this.plugins.SelectableRows&&this.plugins.SelectableRows.createHeaderCol(r),this.options.responsive&&this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.hasHiddenColumns()&&this.plugins.ResponsiveGrid.createHeaderCol(r),o=0;let l=0;for(let d of this.options.columns){if(d.attr)continue;let u=o+this.startColIndex(),h=x("th");h.setAttribute("scope","col"),h.setAttribute("role","columnheader button"),h.setAttribute("aria-colindex",`${u}`),h.setAttribute("id",G("dg-col-")),this.options.sort&&h.setAttribute("aria-sort","none"),h.setAttribute("field",d.field),this.plugins.ResponsiveGrid&&this.options.responsive&&c(h,"data-responsive",d.responsive||"");let f=_(d.title,s,!0)+20;h.dataset.minWidth=`${f}`,xt(h,d),h.tabIndex=0,h.textContent=d.title;let p=0;if(this.options.autosize&&this.plugins.AutosizeColumn){let b=Math.min(e-l,i);p=this.plugins.AutosizeColumn.computeSize(h,d,Number.parseInt(h.dataset.minWidth),b)}else p=Math.max(Number.parseInt(h.dataset.minWidth),Number.parseInt(h.getAttribute("width")));c(h,"width",p),d.hidden?h.setAttribute("hidden",""):l+=p,this.options.reorder&&this.plugins.DraggableHeaders&&this.plugins.DraggableHeaders.makeHeaderDraggable(h),r.appendChild(h),o++}if(l<e){let d=g(r,"th:not([hidden],.dg-not-resizable)");if(d.length){let u=d[d.length-1];L(u,"width")}}if(this.options.actions.length&&this.plugins.RowActions&&this.plugins.RowActions.makeActionHeader(r),t.replaceChild(r,t.querySelector("tr.dg-head-columns")),t.offsetWidth>e){this.log(`adjust width to fix size, ${t.offsetWidth} > ${e}`);let d=this.offsetWidth-this.clientWidth,u=t.offsetWidth-e-d;this.options.responsive&&this.plugins.ResponsiveGrid&&(u+=d);let h=g(r,"th[width]");for(let f of h){if(T(f,"dg-not-resizable")||u<=0)continue;let p=Number.parseInt(f.getAttribute("width")),b=f.dataset.minWidth?Number.parseInt(f.dataset.minWidth):0;if(p>b){let S=p-u;S<b&&(S=b),u-=p-S,c(f,"width",S)}}}this.options.menu&&this.plugins.ContextMenu&&this.plugins.ContextMenu.attachContextMenu();let a=g(r,"[aria-sort]");for(let d of a)d.addEventListener("click",()=>this.sortData(d));c(this.table,"aria-colcount",this.columnsLength(!0))}createColumnFilters(t){let e=0,i;i=x("tr"),this.filterRow=i,i.setAttribute("role","row"),i.setAttribute("aria-rowindex","2"),i.setAttribute("class","dg-head-filters"),this.options.filter||i.setAttribute("hidden",""),this.options.selectable&&this.plugins.SelectableRows&&this.plugins.SelectableRows.createFilterCol(i),this.options.responsive&&this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.hasHiddenColumns()&&this.plugins.ResponsiveGrid.createFilterCol(i);for(let r of this.options.columns){if(r.attr)continue;let s=e+this.startColIndex(),l=t.querySelector(`tr.dg-head-columns th[aria-colindex="${s}"]`);if(!l){console.warn("Related th not found",s);continue}let a=x("th");a.setAttribute("aria-colindex",`${s}`);let d=this.createFilterElement(r,l);this.options.filter?d.tabIndex=0:a.tabIndex=0,r.hidden&&a.setAttribute("hidden",""),a.appendChild(d),i.appendChild(a),e++}this.options.actions.length&&this.plugins.RowActions&&this.plugins.RowActions.makeActionFilter(i),t.replaceChild(i,t.querySelector("tr.dg-head-filters")),(typeof this.options.filterKeypressDelay!="number"||this.options.filterOnEnter)&&(this.options.filterKeypressDelay=0);let o=g(i,this._filterSelector);for(let r of o){let s=/select/i.test(r.tagName)?"change":"keyup",l=q(a=>{let d=a.keyCode||a.key,u=!this.options.filterOnEnter&&!this._excludedKeys.some(h=>h===d);(d===13||d==="Enter"||u||a.type==="change")&&this.filterData.call(this)},this.options.filterKeypressDelay);r.addEventListener(s,l)}}createFilterElement(t,e){let i=t.filterType==="select",o=i?x("select"):x("input");if(i){if(!Array.isArray(t.filterList)){let r=[...new Set((this.data??[]).map(s=>s[t.field]))].filter(s=>s).sort();t.filterList=[t.firstFilterOption||this.defaultColumn.firstFilterOption].concat(r.map(s=>({value:s,text:s})))}for(let r of t.filterList){let s=x("option");s.value=r.value,s.text=r.text,o instanceof HTMLSelectElement&&o.add(s)}}else o.type="text",o.inputMode="search",o.autocomplete="off",o.spellcheck=!1;return o.dataset.name=t.field,o.id=G("dg-filter-"),o.setAttribute("aria-labelledby",e.getAttribute("id")),o}renderBody(){this.log("render body");let t,e,i,o=x("tbody");this.data.forEach((s,l)=>{t=x("tr"),c(t,"role","row"),c(t,"hidden",""),c(t,"aria-rowindex",l+1),t.tabIndex=0,this.options.selectable&&this.plugins.SelectableRows&&this.plugins.SelectableRows.createDataCol(t),this.options.responsive&&this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.hasHiddenColumns()&&this.plugins.ResponsiveGrid.createDataCol(t),this.options.expand&&(t.classList.add("dg-expandable"),A(t,"click",a=>{this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.blockObserver(),bt(a.currentTarget,"dg-expanded"),this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.unblockObserver()})),i=0;for(let a of this.options.columns){if(a||console.error("Empty column found!",this.options.columns),a.attr){s[a.field]&&(a.attr==="class"?E(t,s[a.field]):t.setAttribute(a.attr,s[a.field]));return}if(e=x("td"),e.setAttribute("role","gridcell"),e.setAttribute("aria-colindex",`${i}${this.startColIndex()}`),xt(e,a),e.setAttribute("data-name",a.title),e.tabIndex=-1,a.editable&&this.plugins.EditableColumn)E(e,"dg-editable-col"),this.plugins.EditableColumn.makeEditableInput(e,a,s,l);else{let d=s[a.field]??"",u;switch(a.transform){case"uppercase":u=d.toUpperCase();break;case"lowercase":u=d.toLowerCase();break;default:u=d;break}if(a.format){if(a.defaultFormatValue!==void 0&&(u===""||u===null)&&(u=`${a.defaultFormatValue}`),typeof a.format=="string"&&u)e.innerHTML=M(a.format,Object.assign({_v:d,_tv:u},s));else if(a.format instanceof Function){let h=a.format.call(this,{column:a,rowData:s,cellData:u,td:e,tr:t});e.innerHTML=h||u||d}}else e.textContent=u}t.appendChild(e),i++}this.options.actions.length&&this.plugins.RowActions&&this.plugins.RowActions.makeActionRow(t,s),o.appendChild(t)}),o.setAttribute("role","rowgroup");let r=this.tbody;o.setAttribute("data-empty",r.getAttribute("data-empty")),this.table.replaceChild(o,r),this.plugins.FixedHeight&&this.plugins.FixedHeight.createFakeRow(),this.paginate(),this.plugins.SelectableRows&&this.plugins.SelectableRows.shouldSelectAll(o),this.data.length&&this.classList.remove("dg-empty"),y(this,"bodyRendered")}paginate(){this.log("paginate");let t=this.totalRecords(),e=this.page||1,i=this.tbody,o=this.tfoot,r=g(i,"tr");this.pages=this.totalPages();let s,l=e*this.options.perPage,a=l-this.options.perPage+1;l>t&&(l=t),t||(a=0);for(let d of r){if(this.options.server){L(d,"hidden");continue}s=Number($(d,"aria-rowindex")),s>l||s<a?c(d,"hidden",""):L(d,"hidden")}this.options.selectable&&this.plugins.SelectableRows&&this.plugins.SelectableRows.clearCheckboxes(i),this.plugins.FixedHeight&&this.plugins.FixedHeight.updateFakeRow(),this.btnFirst&&(this.btnFirst.disabled=this.page<=1,this.btnPrev.disabled=this.page<=1,this.btnNext.disabled=this.page>=this.pages,this.btnLast.disabled=this.page>=this.pages),o.querySelector(".dg-low").textContent=a.toString(),o.querySelector(".dg-high").textContent=l.toString(),o.querySelector(".dg-total").textContent=`${this.totalRecords()}`,o.toggleAttribute("hidden",this.options.autohidePager&&this.options.perPage>this.totalRecords())}totalPages(){return Math.ceil(this.totalRecords()/this.options.perPage)}totalRecords(){return this.options.server?this.meta?.[this.options.serverParams.metaFilteredKey]||0:this.data.length}},j=et;var it=class{constructor(t){this.grid=t}connected(){}disconnected(){}handleEvent(t){this[`on${t.type}`]&&this[`on${t.type}`](t)}},m=it;var st=class extends m{constructor(t){super(t),this.isResizing=!1}renderResizer(t){let e=this.grid,i=e.table,o=g(e,"thead tr.dg-head-columns th");for(let r of o){if(T(r,"dg-not-resizable"))continue;let s=document.createElement("div");E(s,"dg-resizer"),s.ariaLabel=t,r.appendChild(s);let l=0,a=0,d=0,u=0,h=p=>{if(p.clientX>u)return;let b=a+(p.clientX-l);r.dataset.minWidth&&b>Number.parseInt(r.dataset.minWidth)&&c(r,"width",b)},f=()=>{e.log("resized column"),setTimeout(()=>{this.isResizing=!1},0),F(s,"dg-resizer-active"),e.options.reorder&&(r.draggable=!0),r.style.overflow="hidden",O(document,"mousemove",h),O(document,"mouseup",f),y(e,"columnResized",{col:$(r,"field"),width:$(r,"width")})};A(s,"click",p=>{p.stopPropagation()}),A(s,"mousedown",p=>{p.stopPropagation(),this.isResizing=!0;let b=p.target,P=g(e,"dg-head-columns th").filter(v=>!v.hasAttribute("hidden")),w=P.findIndex(v=>v===b.parentNode);e.log("resize column"),E(s,"dg-resizer-active"),L(r,"draggable"),r.style.overflow="visible",s.style.height=`${i.offsetHeight-1}px`,l=p.clientX,a=r.offsetWidth,d=(P.length-w)*30,u=Q(b).left+e.offsetWidth-d,c(r,"width",a);for(let v=0;v<P.length;v++)v>w&&L(o[v],"width");A(document,"mousemove",h),A(document,"mouseup",f)})}}},Ct=st;function K(n,t,e="nodeName"){let i=n;for(;i[e]!==t;)i=i.parentElement;return i}var ot=class extends m{connected(){this.menu=this.grid.querySelector(".dg-menu")}disconnected(){this.grid.headerRow&&O(this.grid.headerRow,"contextmenu",this)}attachContextMenu(){let t=this.grid;A(t.headerRow,"contextmenu",this)}onchange(t){let e=this.grid,i=t.target,o=i.dataset.name;if(i.checked)e.showColumn(o);else{if(e.visibleColumns().length<=1){i.checked=!0;return}e.hideColumn(o)}e.fixPage()}oncontextmenu(t){t.preventDefault();let e=this.grid,i=K(t.target,"THEAD"),o=this.menu,r=i.getBoundingClientRect(),s=t.clientX-r.left,l=t.clientY-r.top;o.style.top=`${l}px`,o.style.left=`${s}px`,L(o,"hidden"),s+150>r.width&&(s-=o.offsetWidth,o.style.left=`${s}px`);let a=d=>{o.contains(d.target)||(c(o,"hidden",""),O(document,"click",a))};A(document,"click",a)}createMenu(){let t=this.grid,e=this.menu;for(;e.lastChild;)e.removeChild(e.lastChild);e.addEventListener("change",this);for(let i of t.options.columns){if(i.attr)continue;let o=document.createElement("li"),r=document.createElement("label"),s=document.createElement("input");c(s,"type","checkbox"),c(s,"data-name",i.field),i.hidden||(s.checked=!0);let l=document.createTextNode(i.title);r.appendChild(s),r.appendChild(l),o.appendChild(r),e.appendChild(o)}}},wt=ot;var rt=class extends m{makeHeaderDraggable(t){let e=this.grid;t.draggable=!0,A(t,"dragstart",i=>{if(e.plugins.ColumnResizer?.isResizing&&i.preventDefault){i.preventDefault();return}e.log("reorder col"),i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("text/plain",i.target.getAttribute("aria-colindex"))}),A(t,"dragover",i=>(i.preventDefault&&i.preventDefault(),i.dataTransfer.dropEffect="move",!1)),A(t,"drop",i=>{i.stopPropagation&&i.stopPropagation();let o=i.target,r=K(o,"TH"),s=Number.parseInt(i.dataTransfer.getData("text/plain")),l=Number.parseInt(r.getAttribute("aria-colindex"));if(s===l){e.log("reordered col stayed the same");return}e.log(`reordered col from ${s} to ${l}`);let a=e.startColIndex(),d=e.options.columns[s-a];e.options.columns[s-a]=e.options.columns[l-a],e.options.columns[l-a]=d;let u=(h,f)=>{let p=f.parentNode.getAttribute("aria-rowindex"),b=e.querySelector(`${h} tr[aria-rowindex="${p}"] [aria-colindex="${l}"]`);c(f,"aria-colindex",l),c(b,"aria-colindex",s);let S=document.createElement("th");f.parentNode.insertBefore(S,f),b.parentNode.replaceChild(f,b),S.parentNode.replaceChild(b,S)};for(let h of g(e,`thead th[aria-colindex="${s}"]`))u("thead",h);for(let h of g(e,`tbody td[aria-colindex="${s}"]`))u("tbody",h);return e.options.columns=g(e,"thead tr.dg-head-columns th[field]").map(h=>e.options.columns.find(f=>f.field===$(h,"field"))),y(e,"columnReordered",{col:d.field,from:s,to:l}),!1})}},Pt=rt;var nt=class extends m{constructor(t){super(t),this.touch=null}connected(){let t=this.grid;t.addEventListener("touchstart",this,{passive:!0}),t.addEventListener("touchmove",this,{passive:!0})}disconnected(){let t=this.grid;t.removeEventListener("touchstart",this),t.removeEventListener("touchmove",this)}ontouchstart(t){this.touch=t.touches[0]}ontouchmove(t){if(!this.touch)return;let e=this.grid,i=this.touch.clientX-t.touches[0].clientX,o=this.touch.clientY-t.touches[0].clientY;Math.abs(i)>Math.abs(o)&&(i>0?e.getNext():e.getPrev()),this.touch=null}},At=nt;var H="dg-selectable",St="dg-select-all",kt="form-check-input",at=class extends m{disconnected(){this.selectAll&&this.selectAll.removeEventListener("change",this)}getSelection(t=null){let e=this.grid,i=[],o=g(e,`tbody .${H} input:checked`);for(let r of o){let s=Number.parseInt(r.dataset.id),l=e.data[s-1];l||console.warn(`Item ${s} not found`),t?i.push(l[t]):i.push(l)}return i}clearCheckboxes(t){if(!this.grid.options.selectVisibleOnly)return;let i=g(t,`tr[hidden] .${H} input`);for(let o of i)o.checked=!1;this.selectAll.checked=!1}colIndex(){return this.grid.startColIndex()-2}createHeaderCol(t){let e=document.createElement("th");c(e,"scope","col"),c(e,"role","columnheader button"),c(e,"aria-colindex",this.colIndex()),e.classList.add(H,"dg-not-resizable","dg-not-sortable"),e.tabIndex=0,this.selectAll=document.createElement("input"),this.selectAll.type="checkbox",this.selectAll.classList.add(St),this.selectAll.classList.add(kt),this.selectAll.addEventListener("change",this);let i=document.createElement("label");i.appendChild(this.selectAll),e.appendChild(i),e.setAttribute("width","40"),t.appendChild(e)}createFilterCol(t){let e=document.createElement("th");c(e,"role","columnheader button"),c(e,"aria-colindex",this.colIndex()),e.classList.add(H),e.tabIndex=0,t.appendChild(e)}shouldSelectAll(t){this.selectAll&&(t.addEventListener("change",this),t.dispatchEvent(new Event("change")))}createDataCol(t){let e=document.createElement("td");c(e,"role","gridcell button"),c(e,"aria-colindex",this.colIndex()),e.classList.add(H);let i=document.createElement("input");i.dataset.id=t.getAttribute("aria-rowindex"),i.type="checkbox",i.classList.add(kt);let o=document.createElement("label");o.classList.add("dg-clickable-cell"),o.appendChild(i),e.appendChild(o),o.addEventListener("click",this),t.appendChild(e)}onclick(t){t.stopPropagation()}onchange(t){let e=this.grid;if(T(t.target,St)){let i=e.options.selectVisibleOnly,o=g(e,`tbody .${H} input`);for(let r of o){if(i&&!r.offsetWidth)return;r.checked=this.selectAll.checked}y(e,"rowsSelected",{selection:this.getSelection()})}else{if(!t.target.closest(`.${H}`))return;let i=g(e,`tbody .${H} input[type=checkbox]`),o=i.filter(r=>r.checked);this.selectAll.checked=o.length===i.length,y(e,"rowsSelected",{selection:e.getSelection()})}}},Lt=at;var lt=class extends m{constructor(t){super(t),this.hasFixedHeight=!1,t.style.height&&(t.style.overflowY="auto",this.hasFixedHeight=!0)}createFakeRow(){let e=this.grid.querySelector("tbody"),i=document.createElement("tr");c(i,"role","row"),c(i,"hidden",""),i.classList.add("dg-fake-row"),i.tabIndex=0,e.appendChild(i)}get fakeRow(){return this.grid.querySelector(".dg-fake-row")}updateFakeRow(){let t=this.grid,e=this.fakeRow;if(!e||t.options.perPage>t.totalRecords()||t.page!==t.totalPages()||!t.options.autoheight)return;let i=t.options.perPage*t.rowHeight,o=t.querySelectorAll("tbody tr:not([hidden])").length,r=o>1?i-o*t.rowHeight:i;r>0?(c(e,"height",r),e.removeAttribute("hidden")):e.removeAttribute("height")}},Et=lt;var dt=class extends m{computeSize(t,e,i,o){let r=this.grid;if(U(t,"width"))return $(t,"width");if(!r.data.length)return;let s=r.data[0],l=r.data[r.data.length-1],a=s[e.field]?s[e.field].toString():"",d=l[e.field]?l[e.field].toString():"";d.length>a.length&&(a=d);let u=0;return a.length<=6?u=i:a.length>50?u=o:u=_(`${a}0000`,t),u>o&&(u=o),u<i&&(u=i),c(t,"width",u),u}},$t=dt;var k="dg-responsive",ct;function Wt(n){return n.sort((t,e)=>{let i=Number.parseInt(t.dataset.responsive)||1;return(Number.parseInt(e.dataset.responsive)||1)-i})}var Ft=q(n=>{for(let t of n){let e=t.target,i=e.table;if(e.plugins.ResponsiveGrid.observerBlocked)return;let o=Array.isArray(t.contentBoxSize)?t.contentBoxSize[0]:t.contentBoxSize,r=Number.parseInt(o.inlineSize),s=i.offsetWidth,l=g(e.headerRow,"th").reduce((P,w)=>P+w.offsetWidth,0),a=(l||s)-r-1,d=50,u=e.plugins.ResponsiveGrid.prevAction,h=Wt(g(e.headerRow,"th[field]").reverse().filter(P=>P.dataset.responsive!=="0")),f=!1;if(e.log(`table is ${s}/${l} and available size is ${r}. Diff: ${a}`),a>0){if(u==="show")return;e.plugins.ResponsiveGrid.prevAction="hide";let P=a,w=h.filter(v=>!v.hasAttribute("hidden")&&v.hasAttribute("data-responsive"));if(w.length===0&&(w=h.filter(v=>!v.hasAttribute("hidden")),w.length===1))return;for(let v of w){if(P<0)continue;let D=v.offsetWidth,R=v.getAttribute("field");R&&(v.dataset.baseWidth=`${v.offsetWidth}`,e.hideColumn(R,!1),e.setColProp(R,"responsiveHidden",!0),f=!0,P-=D,P=Math.round(P))}}else{if(u==="hide")return;e.plugins.ResponsiveGrid.prevAction="show";let P=h.filter(D=>!D.hasAttribute("hidden")).reduce((D,R)=>{let z=R.dataset.minWidth?Number.parseInt(R.dataset.minWidth):R.offsetWidth;return D+z},0)+d,w=r-P,v=h.slice().reverse().filter(D=>D.hasAttribute("hidden"));for(let D of v){if(w<d)continue;let R=Number.parseInt(D.dataset.minWidth);if(R>w){w=-1;continue}let z=D.getAttribute("field");z&&(e.showColumn(z,!1),e.setColProp(z,"responsiveHidden",!1),f=!0,w-=R,w=Math.round(w))}}let p=N(e.table,"tfoot"),b=g(e.table,".dg-footer > div").reduce((P,w)=>P+w.offsetWidth,0),S=p.offsetWidth-b;b>r?E(p,"dg-footer-compact"):S>250&&F(p,"dg-footer-compact"),f&&e.renderTable(),setTimeout(()=>{e.plugins.ResponsiveGrid.prevAction=null},1e3),e.table.style.visibility="visible"}},100),Dt=new ResizeObserver(Ft),ht=class extends m{constructor(t){super(t),this.observerBlocked=!1,this.prevAction=null}connected(){this.grid.options.responsive&&this.observe()}disconnected(){this.unobserve()}observe(){this.grid.options.responsive&&(Dt.observe(this.grid),this.grid.style.display="block",this.grid.style.overflowX="hidden")}unobserve(){Dt.unobserve(this.grid),this.grid.style.display="unset",this.grid.style.overflowX="unset"}blockObserver(){this.observerBlocked=!0,ct&&clearTimeout(ct)}unblockObserver(){ct=setTimeout(()=>{this.observerBlocked=!1},200)}hasHiddenColumns(){let t=!1;for(let e of this.grid.options.columns)e.responsiveHidden&&(t=!0);return t}colIndex(){return this.grid.startColIndex()-1}createHeaderCol(t){if(!this.grid.options.responsiveToggle)return;let e=x("th",t);c(e,"scope","col"),c(e,"role","columnheader button"),c(e,"aria-colindex",this.colIndex()),c(e,"width","40"),e.classList.add(`${k}-toggle`,"dg-not-resizable","dg-not-sortable"),e.tabIndex=0}createFilterCol(t){if(!this.grid.options.responsiveToggle)return;let e=x("th",t);c(e,"role","columnheader button"),c(e,"aria-colindex",this.colIndex()),e.classList.add(`${k}-toggle`),e.tabIndex=0}createDataCol(t){if(!this.grid.options.responsiveToggle)return;let e=document.createElement("td");c(e,"role","gridcell button"),c(e,"aria-colindex",this.colIndex()),e.classList.add(`${k}-toggle`),e.innerHTML=`<div class='dg-clickable-cell'><svg class='${k}-open' viewbox="0 0 24 24" height="24" width="24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
</svg>
<svg class='${k}-close' viewbox="0 0 24 24" height="24" width="24" style="display:none">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
</svg></div>`,t.appendChild(e),e.addEventListener("click",this),e.addEventListener("mousedown",this)}computeLabelWidth(){let t=0,e=0;for(;t<120;){e++;let i=N(this.grid,`.dg-head-columns th[aria-colindex="${e}"]`);if(i)t+=i.offsetWidth;else break}return t}onmousedown(t){t.preventDefault()}onclick(t){t.stopPropagation();let e=t.currentTarget,i=e.parentElement,o=N(e,`.${k}-open`),r=N(e,`.${k}-close`);if(this.blockObserver(),T(i,`${k}-expanded`)){F(i,`${k}-expanded`),o.style.display="unset",r.style.display="none";let l=i.nextElementSibling,a=g(l,`.${k}-hidden`);for(let d of a)i.appendChild(d),c(d,"hidden");l.parentElement.removeChild(l)}else{E(i,`${k}-expanded`),o.style.display="none",r.style.display="unset";let l=x("tr");vt(l,i),E(l,`${k}-child-row`);let a=x("td",l);c(a,"colspan",this.grid.columnsLength(!0));let d=x("table",a);E(d,`${k}-table`);let u=g(i,`.${k}-hidden`),h=this.computeLabelWidth();for(let f of u){let p=x("tr",d),b=f.dataset.name,S=x("th",p);S.style.width=`${h}px`,S.innerHTML=b,p.appendChild(f),L(f,"hidden")}}this.unblockObserver()}},Rt=ht;var ut=class extends m{hasActions(){return this.grid.options.actions.length>0}makeActionHeader(t){let e=document.createElement("th");c(e,"role","columnheader button"),c(e,"aria-colindex",this.grid.columnsLength(!0)),e.classList.add("dg-actions","dg-not-sortable","dg-not-resizable",this.actionClass),e.tabIndex=0,t.appendChild(e)}makeActionFilter(t){let e=document.createElement("th");e.setAttribute("role","columnheader button"),c(e,"aria-colindex",this.grid.columnsLength(!0)),e.classList.add("dg-actions",this.actionClass),e.tabIndex=0,t.appendChild(e)}makeActionRow(t,e){let i=this.grid.labels,o=document.createElement("td");c(o,"role","gridcell"),c(o,"aria-colindex",this.grid.columnsLength(!0)),o.classList.add("dg-actions",this.actionClass),o.tabIndex=0;let r=document.createElement("button");r.classList.add("dg-actions-toggle"),r.innerHTML="\u2630",o.appendChild(r),A(r,"click",s=>{s.stopPropagation(),s.target.parentElement.classList.toggle("dg-actions-expand")});for(let s of this.grid.options.actions){let l=document.createElement("button");s.html?l.innerHTML=s.html:l.innerText=s.title??s.name,s.title&&(l.title=s.title),s.url&&(l.type="submit",l.formAction=M(s.url,e)),s.class&&l.classList.add(...s.class.split(" "));let a=d=>{if(d.stopPropagation(),s.confirm&&!confirm(i.areYouSure)){d.preventDefault();return}y(this.grid,"action",{data:e,action:s.name})};l.addEventListener("click",a),o.appendChild(l),s.default&&(t.classList.add("dg-actionable"),t.addEventListener("click",a))}t.appendChild(o)}get actionClass(){return this.grid.options.actions.length<3&&!this.grid.options.collapseActions?`dg-actions-${this.grid.options.actions.length}`:"dg-actions-more"}},It=ut;var gt=class extends m{makeEditableInput(t,e,i,o){let r=this.grid.getAttribute("id"),s=document.createElement("input");s.type=e.editableType||"text",s.type==="email"&&(s.inputMode="email"),s.type==="decimal"&&(s.type="text",s.inputMode="decimal"),s.autocomplete="off",s.spellcheck=!1,s.tabIndex=0,s.classList.add("dg-editable"),s.name=`${r.replace("-","_")}[${o+1}][${e.field}]`,s.value=i[e.field],s.dataset.field=e.field,s.addEventListener("click",l=>l.stopPropagation()),s.addEventListener("keypress",l=>{if(l.type==="keypress"){let a=l.keyCode||l.key;(a===13||a==="Enter")&&(s.blur(),l.preventDefault())}}),s.addEventListener("blur",()=>{s.value!==i[s.dataset.field]&&(i[s.dataset.field]=s.value,y(this.grid,"edit",{data:i,value:s.value}))}),t.appendChild(s)}},Tt=gt;var pt=class extends m{connected(){this.grid.options.spinnerClass&&this.grid.plugins.SpinnerSupport&&this.add()}add(){let t=this.grid,e=t.options.spinnerClass;if(!e)return;let i=e.split(" ").map(r=>`.${r}`).join(""),o=`
<style id="dg-styles">
  data-grid ${i} { position: absolute; top: 37%; left: 47%; z-index: 999; }
  data-grid:not(.dg-loading) ${i} { display: none; }
  data-grid:not(.dg-initialized).dg-loading ${i} { top: 0; }
  @media only screen and (max-width: 767px) {
    data-grid[responsive] ${i} { top: 8rem; left: 42%; }
  }
</style>
`;if(!I("#dg-styles")){let r=I("head")??I("body"),s=/head/i.test(r.tagName)?"beforeend":"afterbegin";r.insertAdjacentHTML(s,o)}!I(`i${i}`,t)&&t.insertAdjacentHTML("afterbegin",`<i class="${e}"></i>`)}},Nt=pt;var ft=class extends m{constructor(t){super(t),this.cachedState=null,this.isFilterSortSet=!1,this.isDataLoaded=!1,this.isScrolled=!1,this.log("Init")}connected(){this.log("connected");let t=this.grid;if(!t.options.saveState){this.log("disabled");return}this.log("enabled");let e=this._getState();if(e){this.log("hide columns");for(let r of e.columns)if(r.hidden){let s=t.options.columns.find(l=>l.field===r.field);s.hidden=!0}this.log("set: meta, pages"),t.options.perPage=e.perPage,t.options.server&&(t.meta=e.meta,t.pages=e.pages,t.page=e.page)}this.cachedState=e;let i=t.loadData;t.loadData=function(...r){return new Promise((s,l)=>{i.apply(this,r).finally(()=>{let a=this.plugins.SaveState;if(!t.classList.contains("dg-initialized"))return a.log("not init, loadData skipped"),s();if(a.log("loadData finished, set param controls"),a.cachedState&&!a.isFilterSortSet){a.log("set sort and filters");let h=g(t,"thead tr.dg-head-columns th[aria-sort]");for(let p of h)p.setAttribute("aria-sort","none");t.querySelector(`thead tr.dg-head-columns th[field='${a.cachedState.sort}']`)?.setAttribute("aria-sort",a.cachedState.sortDir);let f=g(t.filterRow,"[id^=dg-filter]");for(let p of f)p.value=a.cachedState.filters[p.dataset.name];a.isFilterSortSet=!0}let d={meta:t.meta,pages:t.pages,page:t.page,perPage:t.options.perPage,filters:{},columns:t.options.columns.map(h=>({field:h.field,hidden:h.hidden})),sort:t.getSort(),sortDir:t.getSortDir(),scrollTo:window.scrollY},u=t.getFilters();for(let h of Object.keys(u))d.filters[h]=u[h];a.log("store new state"),a._setState(d),!t.options.server&&a.cachedState&&!a.isDataLoaded&&(a.isDataLoaded=!0,t.filterData(),t.page=a.cachedState.page,t.pageChanged()),s()})})};let o=()=>{let r=t.plugins.SaveState,s=r._getState();s&&(s.columns=t.options.columns.map(l=>({field:l.field,hidden:l.hidden})),s.sort=t.getSort(),s.sortDir=t.getSortDir(),s.scrollTo=window.scrollY,r._setState(s))};document.addEventListener("scrollend",o),t.addEventListener("headerRendered",o),t.addEventListener("bodyRendered",r=>{if(!t.classList.contains("dg-initialized")||t.classList.contains("dg-loading"))return;t.options.server||o();let s=t.plugins.SaveState;!s.cachedState||!s.isFilterSortSet||(s.isDataLoaded?s.isScrolled||(s.isScrolled=!0,window.scrollTo({top:s.cachedState.scrollTo,left:0,behavior:"instant"})):(s.isDataLoaded=!0,t.reload()))})}log(t){this.grid.log(`[Save-State] ${t}`)}_getState(){let t;try{t=JSON.parse(sessionStorage.getItem(`gridSaveState_${this.grid.id}`))}catch{}return t}_setState(t){sessionStorage.setItem(`gridSaveState_${this.grid.id}`,JSON.stringify(t))}},Ht=ft;j.registerPlugins({ColumnResizer:Ct,ContextMenu:wt,DraggableHeaders:Pt,TouchSupport:At,SelectableRows:Lt,FixedHeight:Et,AutosizeColumn:$t,ResponsiveGrid:Rt,RowActions:It,EditableColumn:Tt,SpinnerSupport:Nt,SaveState:Ht});customElements.get("data-grid")||customElements.define("data-grid",j);var yi=j,Mt=typeof globalThis<"u"?globalThis:self;Mt.DataGrid=j;export{yi as default};
/**
 * Data Grid custom element
 * https://github.com/lekoala/data-grid/
 * @license MIT
 */
//# sourceMappingURL=data-grid.min.js.map
