function F(n){return n.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(t,e)=>e.toUpperCase())}function _(n){if(n==="true")return!0;if(n==="false")return!1;if(n===""||n==="null")return null;if(n===Number(n).toString())return Number(n);if(n&&["[","{"].includes(n.substring(0,1)))try{return n.indexOf('"')===-1&&(n=n.replace(/'/g,'"')),JSON.parse(decodeURIComponent(n))}catch{return console.error("Failed to parse "+n),{}}return n}var Ot=["scroll","wheel","touchstart","touchmove","touchenter","touchend","touchleave","mouseout","mouseleave","mouseup","mousedown","mousemove","mouseenter","mousewheel","mouseover"];function pt(n){return Ot.includes(n)?{passive:!0}:{}}function k(n,t){return n.getAttribute(t)}function K(n,t){return n.hasAttribute(t)}function h(n,t,e="",i=!1){i&&K(n,t)||n.setAttribute(t,""+e)}function E(n,t){K(n,t)&&n.removeAttribute(t)}function w(n,t,e){n.addEventListener(t,e,pt(t))}function H(n,t,e){n.removeEventListener(t,e,pt(t))}function x(n,t,e={},i=!1){let s={};i&&(s.bubbles=!0),e&&(s.detail=e),n.dispatchEvent(new CustomEvent(t,s))}function I(n,t){return n.classList.contains(t)}function L(n,t){n.classList.add(...t.split(" "))}function q(n,t){n.classList.remove(...t.split(" "))}function ft(n,t){n.classList.toggle(t)}function W(n,t=document){return n instanceof HTMLElement?n:t.querySelector(n)}function zt(n,t=document){return Array.from(t.querySelectorAll(n))}function T(n,t){return W(t,n)}function f(n,t){return zt(t,n)}function y(n,t=null){let e=document.createElement(n);return t&&t.appendChild(e),e}function mt(n,t){t.parentNode.insertBefore(n,t.nextSibling)}var X=class extends HTMLElement{constructor(t={}){super(),this.options=Object.assign({},this.defaultOptions,this.normalizedDataset,t),this.log("constructor"),this.fireEvents=!0,this._ready(),this.log("ready")}get defaultOptions(){return{}}getOption(t){return this.options[t]}setOption(t,e){h(this,`data-${t}`,e)}toggleOption(t){h(this,`data-${t}`,!this.getOption(t))}get normalizedDataset(){let t=this.dataset.config?JSON.parse(this.dataset.config):{},e={...this.dataset};for(var i in e)i!="config"&&(e[i]=_(e[i]));return Object.assign(e,t),e}static template(){return""}_ready(){}log(t){this.options.debug&&console.log("["+k(this,"id")+"] "+t)}handleEvent(t){this[`on${t.type}`]&&this[`on${t.type}`](t)}_connected(){}connectedCallback(){setTimeout(()=>{this.log("connectedCallback");let t=document.createElement("template");t.innerHTML=this.constructor.template(),this.appendChild(t.content.cloneNode(!0)),this._connected(),x(this,"connected")},0)}_disconnected(){}disconnectedCallback(){this.log("disconnectedCallback"),this._disconnected(),x(this,"disconnected")}get transformAttributes(){return{}}attributeChangedCallback(t,e,i){if(e===i)return;this.log("attributeChangedCallback: "+t);let s=!1,o=this.transformAttributes[t]??_;t.indexOf("data-")===0&&(t=t.slice(5),s=!0),t=F(t),s?this.options[t]=o(i):this[t]=o(i),this.fireEvents&&this[`${t}Changed`]&&this[`${t}Changed`]()}},bt=X;function Y(n,t,e,i=!1){let s=document.createElement("option");s.value=""+t,i&&(s.selected=!0),s.label=e,n.appendChild(s)}function J(n,t={}){Object.keys(t).forEach(e=>{Array.isArray(t[e])?Object.keys(t[e]).forEach(i=>n.searchParams.append(isNaN(i)?`${e}[${i}]`:e,t[e][i])):n.searchParams.append(e,t[e])})}function V(n){return typeof n=="string"?n[0]==="["?(n.indexOf('"')===-1&&(n=n.replace(/'/g,'"')),JSON.parse(n)):n.split(","):Array.isArray(n)?n:(console.error("Invalid array",n),[])}function Z(n){var t=n.getBoundingClientRect(),e=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+i,left:t.left+e}}function N(n,t){return n.replace(/\{([^}]+)?\}/g,function(e,i){return t[i]})}function z(n,t=document.body,e=!1){t||(t=document.createElement("div"));let i=window.getComputedStyle(t),s=i.getPropertyValue("font-weight")||"normal",o=i.getPropertyValue("font-size")||"1rem",r=i.getPropertyValue("font-family")||"Arial",a=0;if(e){let u=i.getPropertyValue("padding-left")||"0",g=i.getPropertyValue("padding-right")||"0";a=parseInt(u)+parseInt(g)}let c=(z.canvas||(z.canvas=document.createElement("canvas"))).getContext("2d");c.font=`${s} ${o} ${r}`;let d=c.measureText(n);return parseInt(d.width)+a}function M(n){return Math.random().toString(36).replace("0.",n||"")}function B(n,t=300){let e=null;return(...i)=>{clearTimeout(e),e=setTimeout(()=>{e=null,n(...i)},t)}}var G={},C={itemsPerPage:"Items per page",gotoPage:"Go to page",gotoFirstPage:"Go to first page",gotoPrevPage:"Go to previous page",gotoNextPage:"Go to next page",gotoLastPage:"Go to last page",of:"of",items:"items",resizeColumn:"Resize column",noData:"No data",areYouSure:"Are you sure?",networkError:"Network response error"};function vt(n,t){t.width&&h(n,"width",t.width),t.class&&L(n,t.class),t.hidden&&(h(n,"hidden",""),t.responsiveHidden&&L(n,"dg-responsive-hidden"))}var Q=class n extends bt{#t="[id^=dg-filter]";#i=[37,39,38,40,45,36,35,33,34,27,20,16,17,91,92,18,93,144,231,"ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Insert","Home","End","PageUp","PageDown","Escape","CapsLock","Shift","Control","Meta","Alt","ContextMenu","NumLock","Unidentified"];_ready(){h(this,"id",this.options.id??M("el-"),!0),this.data=[],this.originalData,this.options=this.options||this.defaultOptions,this.fireEvents=!1,this.page=this.options.defaultPage||1,this.pages=0,this.meta,this.plugins={};for(let[t,e]of Object.entries(G))this.plugins[t]=new e(this);for(let t of n.observedAttributes)t.indexOf("data-")===0&&h(this,t,this.options[F(t.slice(5))]);this.options.spinnerClass&&this.plugins.SpinnerSupport&&this.plugins.SpinnerSupport.add()}static template(){return`
<table role="grid" >
    <thead role="rowgroup">
        <tr role="row" aria-rowindex="1" class="dg-head-columns"><th><!-- keep for getTextWidth --></th></tr>
        <tr role="row" aria-rowindex="2" class="dg-head-filters"></tr>
    </thead>
    <tbody role="rowgroup" data-empty="${C.noData}"></tbody>
    <tfoot role="rowgroup" hidden>
        <tr role="row" aria-rowindex="1">
            <td role="gridcell">
            <div class="dg-footer">
                <div class="dg-page-nav">
                  <select class="dg-select-per-page" aria-label="${C.itemsPerPage}"></select>
                </div>
                <div class="dg-pagination">
                  <button type="button" class="dg-btn-first dg-rotate" title="${C.gotoFirstPage}" aria-label="${C.gotoFirstPage}" disabled>
                    <i class="dg-skip-icon"></i>
                  </button>
                  <button type="button" class="dg-btn-prev dg-rotate" title="${C.gotoPrevPage}" aria-label="${C.gotoPrevPage}" disabled>
                    <i class="dg-nav-icon"></i>
                  </button>
                  <input type="number" class="dg-input-page" min="1" step="1" value="1" aria-label="${C.gotoPage}">
                  <button type="button" class="dg-btn-next" title="${C.gotoNextPage}" aria-label="${C.gotoNextPage}" disabled>
                    <i class="dg-nav-icon"></i>
                  </button>
                  <button type="button" class="dg-btn-last" title="${C.gotoLastPage}" aria-label="${C.gotoLastPage}" disabled>
                    <i class="dg-skip-icon"></i>
                  </button>
                </div>
                <div class="dg-meta">
                  <span class="dg-low">0</span> - <span class="dg-high">0</span> ${C.of} <span class="dg-total">0</span> ${C.items}
                </div>
            </div>
            </td>
        </tr>
    </tfoot>
    <ul class="dg-menu" hidden></ul>
</table>
`}get labels(){return C}static getLabels(){return C}static setLabels(t){C=Object.assign(C,t)}get defaultColumn(){return{field:"",title:"",width:0,class:"",attr:"",hidden:!1,editable:!1,noSort:!1,responsive:1,responsiveHidden:!1,format:"",transform:"",filterType:"text",firstFilterOption:{value:"",text:""}}}get defaultOptions(){return{id:null,url:null,perPage:10,debug:!1,filter:!1,menu:!1,sort:!1,server:!1,serverParams:{start:"start",length:"length",search:"search",sort:"sort",sortDir:"sortDir",dataKey:"data",metaKey:"meta",metaTotalKey:"total",metaFilteredKey:"filtered",optionsKey:"options",paramsKey:"params"},defaultSort:"",reorder:!1,dir:"ltr",perPageValues:[10,25,50,100,250],hidePerPage:!1,columns:[],actions:[],collapseActions:!1,selectable:!1,selectVisibleOnly:!0,defaultPage:1,resizable:!1,autosize:!0,expand:!1,autoheight:!0,autohidePager:!1,responsive:!1,responsiveToggle:!0,filterOnEnter:!0,filterKeypressDelay:500}}static registerPlugins(t){G=t}static unregisterPlugins(t=null){t===null?G={}:delete G[t]}static registeredPlugins(){return G}convertColumns(t){let e=[];return typeof t=="object"&&!Array.isArray(t)?Object.keys(t).forEach(i=>{let s=Object.assign({},this.defaultColumn);s.title=t[i],s.field=i,e.push(s)}):t.forEach(i=>{let s=Object.assign({},this.defaultColumn);typeof i=="string"?(s.title=i,s.field=i):typeof i=="object"?(s=Object.assign(s,i),s.field||console.error("Invalid column definition",i),s.title||(s.title=s.field)):console.error("Column definition must be a string or an object"),e.push(s)}),e}static get observedAttributes(){return["page","data-filter","data-sort","data-debug","data-reorder","data-menu","data-selectable","data-url","data-per-page","data-responsive"]}get transformAttributes(){return{columns:t=>this.convertColumns(V(t)),actions:t=>V(t),defaultPage:t=>parseInt(t),perPage:t=>parseInt(t)}}get page(){return parseInt(this.getAttribute("page"))}set page(t){h(this,"page",this.constrainPageValue(t))}urlChanged(){this.loadData().then(()=>{this.configureUi()})}constrainPageValue(t){return this.pages<t&&(t=this.pages),(t<1||!t)&&(t=1),t}fixPage(){this.pages=this.totalPages(),this.page=this.constrainPageValue(this.page),h(this.inputPage,"max",this.pages),this.inputPage.value=""+this.page,this.inputPage.disabled=this.pages<2}pageChanged(){this.reload()}responsiveChanged(){this.plugins.ResponsiveGrid&&(this.options.responsive?this.plugins.ResponsiveGrid.observe():this.plugins.ResponsiveGrid.unobserve())}menuChanged(){this.renderHeader()}changePerPage(){this.options.perPage=parseInt(this.selectPerPage.options[this.selectPerPage.selectedIndex].value),this.perPageChanged()}perPageChanged(){this.options.perPage!==parseInt(this.selectPerPage.options[this.selectPerPage.selectedIndex].value)&&this.perPageValuesChanged();let t=this.page;for(;t>1&&this.page*this.options.perPage>this.totalRecords();)t--;t!=this.page?this.page=t:this.reload(()=>{(!this.plugins.FixedHeight||!this.plugins.FixedHeight.hasFixedHeight)&&this.selectPerPage.scrollIntoView()})}dirChanged(){h(this,"dir",this.options.dir)}defaultSortChanged(){this.sortChanged()}perPageValuesChanged(){if(this.selectPerPage){for(;this.selectPerPage.lastChild;)this.selectPerPage.removeChild(this.selectPerPage.lastChild);this.options.perPageValues.forEach(t=>{Y(this.selectPerPage,t,t,t===this.options.perPage)})}}_connected(){this.table=this.querySelector("table"),this.btnFirst=this.querySelector(".dg-btn-first"),this.btnPrev=this.querySelector(".dg-btn-prev"),this.btnNext=this.querySelector(".dg-btn-next"),this.btnLast=this.querySelector(".dg-btn-last"),this.selectPerPage=this.querySelector(".dg-select-per-page"),this.inputPage=this.querySelector(".dg-input-page"),this.getFirst=this.getFirst.bind(this),this.getPrev=this.getPrev.bind(this),this.getNext=this.getNext.bind(this),this.getLast=this.getLast.bind(this),this.changePerPage=this.changePerPage.bind(this),this.gotoPage=this.gotoPage.bind(this),this.btnFirst.addEventListener("click",this.getFirst),this.btnPrev.addEventListener("click",this.getPrev),this.btnNext.addEventListener("click",this.getNext),this.btnLast.addEventListener("click",this.getLast),this.selectPerPage.addEventListener("change",this.changePerPage),this.selectPerPage.toggleAttribute("hidden",this.options.hidePerPage),this.inputPage.addEventListener("input",this.gotoPage),Object.values(this.plugins).forEach(t=>{t.connected()}),this.dirChanged(),this.perPageValuesChanged(),this.loadData().finally(()=>{this.configureUi(),this.sortChanged(),this.classList.add("dg-initialized"),this.filterChanged(),this.reorderChanged(),this.dirChanged(),this.perPageValuesChanged(),this.pageChanged(),this.fireEvents=!0,this.log("initialized")})}_disconnected(){this.btnFirst.removeEventListener("click",this.getFirst),this.btnPrev.removeEventListener("click",this.getPrev),this.btnNext.removeEventListener("click",this.getNext),this.btnLast.removeEventListener("click",this.getLast),this.selectPerPage.removeEventListener("change",this.changePerPage),this.inputPage.removeEventListener("input",this.gotoPage),Object.values(this.plugins).forEach(t=>{t.disconnected()})}getCol(t){let e=null;return this.options.columns.forEach(i=>{i.field==t&&(e=i)}),e}getColProp(t,e){let i=this.getCol(t);return i?i[e]:null}setColProp(t,e,i){let s=this.getCol(t);s&&(s[e]=i)}visibleColumns(){return this.options.columns.filter(t=>!t.hidden)}hiddenColumns(){return this.options.columns.filter(t=>t.hidden===!0)}showColumn(t,e=!0){this.setColProp(t,"hidden",!1),e&&this.renderTable(),x(this,"columnVisibility",{col:t,visibility:"visible"})}hideColumn(t,e=!0){this.setColProp(t,"hidden",!0),e&&this.renderTable(),x(this,"columnVisibility",{col:t,visibility:"hidden"})}startColIndex(){let t=1;return this.options.selectable&&this.plugins.SelectableRows&&t++,this.options.responsive&&this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.hasHiddenColumns()&&t++,t}isSticky(){return this.hasAttribute("sticky")}columnsLength(t=!1){let e=0;return this.options.columns.forEach(i=>{t&&i.hidden||i.attr||e++}),this.options.selectable&&this.plugins.SelectableRows&&e++,this.options.actions.length&&this.plugins.RowActions&&e++,this.options.responsive&&this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.hasHiddenColumns()&&e++,e}configureUi(){if(h(this.querySelector("table"),"aria-rowcount",this.data.length),this.table.style.visibility="hidden",this.renderTable(),this.options.responsive&&this.plugins.ResponsiveGrid||(this.table.style.visibility="visible"),!this.rowHeight){let t=T(this,"tbody tr")||T(this,"table tr");t&&(this.rowHeight=t.offsetHeight)}}filterChanged(){let t=this.querySelector("thead tr.dg-head-filters");this.options.filter?E(t,"hidden"):(this.clearFilters(),h(t,"hidden",""))}reorderChanged(){f(this,"thead tr.dg-head-columns th").forEach(e=>{e.classList.contains("dg-selectable")||e.classList.contains("dg-actions")||(this.options.reorder&&this.plugins.DraggableHeaders?e.draggable=!0:e.removeAttribute("draggable"))})}sortChanged(){this.log("toggle sort"),this.querySelectorAll("thead tr.dg-head-columns th").forEach(t=>{let e=t.getAttribute("field");t.classList.contains("dg-not-sortable")||!this.fireEvents&&e==this.options.defaultSort||(this.options.sort&&!this.getColProp(e,"noSort")?h(t,"aria-sort","none"):E(t,"aria-sort"))})}selectableChanged(){this.renderTable()}addRow(t){Array.isArray(this.originalData)&&(this.log("Add row"),this.originalData.push(t),this.data=this.originalData.slice(),this.sortData())}removeRow(t=null,e=null){if(Array.isArray(this.originalData)){e===null&&(e=this.options.columns[0].field),t===null&&(t=this.originalData[this.originalData.length-1][e]),this.log("Removing "+e+":"+t);for(let i=0;i<this.originalData.length;i++)if(this.originalData[i][e]===t){this.originalData.splice(i,1);break}this.data=this.originalData.slice(),this.sortData()}}getSelection(t=null){return this.plugins.SelectableRows?this.plugins.SelectableRows.getSelection(t):[]}getData(){return this.originalData}clearData(){this.data.length!==0&&(this.data=this.originalData=[],this.renderBody())}preload(t){let e=this.options.serverParams.metaKey,i=this.options.serverParams.dataKey;t?.[e]&&(this.meta=t[e]),t?.[i]&&(this.data=this.originalData=t[i])}refresh(t=null){return this.data=this.originalData=[],this.reload(t)}reload(t=null){this.log("reload");let e=!this.originalData?.length;this.fixPage(),this.loadData().finally(()=>{this.options.server||e?this.renderBody():this.paginate(),t&&t()})}loadData(){let t=()=>!this.data.length&&this.classList.add("dg-empty"),e=this.querySelector("tbody");return(this.meta||this.originalData||this.classList.contains("dg-initialized"))&&(!this.options.server||this.options.server&&!this.fireEvents)?(this.log("skip loadData"),t(),new Promise(i=>{i()})):(this.log("loadData"),this.loading=!0,this.classList.add("dg-loading"),this.classList.remove("dg-empty","dg-network-error"),this.fetchData().then(i=>{if(Array.isArray(i))this.data=i;else{if(!i[this.options.serverParams.dataKey]){console.error("Invalid response, it should contain a data key with an array or be a plain array",i),this.options.url=null;return}this.options=Object.assign(this.options,i[this.options.serverParams.optionsKey]??{}),this.meta=i[this.options.serverParams.metaKey]??{},this.data=i[this.options.serverParams.dataKey]}this.originalData=this.data.slice(),this.fixPage(),this.options.columns.length===0&&this.originalData.length?this.options.columns=this.convertColumns(Object.keys(this.originalData[0])):this.options.columns=this.convertColumns(this.options.columns)}).catch(i=>{this.log(i),i.message&&e.setAttribute("data-empty",i.message.replace(/^\s+|\r\n|\n|\r$/g,"")),this.classList.add("dg-empty","dg-network-error")}).finally(()=>{t(),!this.classList.contains("dg-network-error")&&e.getAttribute("data-empty")!=this.labels.noData&&e.setAttribute("data-empty",this.labels.noData),this.classList.remove("dg-loading"),this.loading=!1}))}getFirst(){this.loading||(this.page=1)}getLast(){this.loading||(this.page=this.pages)}getPrev(){this.loading||(this.page=this.page-1)}getNext(){this.loading||(this.page=this.page+1)}gotoPage(t){if(t.type==="keypress"){let e=t.keyCode||t.key;if(e===13||e==="Enter")t.preventDefault();else return}this.page=parseInt(this.inputPage.value)}getSort(){let t=this.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']");return t?t.getAttribute("field"):this.options.defaultSort}getSortDir(){let t=this.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']");return t&&t.getAttribute("aria-sort")||""}getFilters(){let t=[];return f(this,this.#t).forEach(i=>{t[i.dataset.name]=i.value}),t}clearFilters(){f(this,this.#t).forEach(e=>{e.value=""}),this.filterData()}filterData(){if(this.log("filter data"),this.page=1,this.options.server)this.reload();else{this.data=this.originalData?.slice()??[],f(this,this.#t).forEach(i=>{let s=i.value;if(s){let o=i.dataset.name;this.data=this.data.filter(r=>(r[o]+"").toLowerCase().indexOf(s.toLowerCase())!==-1)}}),this.pageChanged();let e=this.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']");this.options.sort&&e?this.sortData():this.renderBody()}}sortData(t=null){if(this.log("sort data"),t&&this.getColProp(t.getAttribute("field"),"noSort")){this.log("sorting prevented because column is not sortable");return}if(this.plugins.ColumnResizer&&this.plugins.ColumnResizer.isResizing){this.log("sorting prevented because resizing");return}if(this.loading){this.log("sorting prevented because loading");return}if(t!==null){let e=i=>["dg-selectable","dg-actions","dg-responsive-toggle"].includes(i);this.querySelectorAll("thead tr:first-child th").forEach(i=>{[...i.classList].some(e)||i!==t&&i.setAttribute("aria-sort","none")}),!t.hasAttribute("aria-sort")||t.getAttribute("aria-sort")==="none"?t.setAttribute("aria-sort","ascending"):t.getAttribute("aria-sort")==="ascending"?t.setAttribute("aria-sort","descending"):t.getAttribute("aria-sort")==="descending"&&t.setAttribute("aria-sort","none")}else t=this.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']");if(this.options.server)this.loadData().finally(()=>{this.renderBody()});else{let e=t?t.getAttribute("aria-sort"):"none";if(e==="none"){let i=[];this.originalData?.some(s=>(this.data.some(o=>JSON.stringify(s)===JSON.stringify(o)?(i.push(o),!0):!1),i.length===this.data.length)),this.data=i}else{let i=t.getAttribute("field");this.data.sort((s,o)=>{if(!isNaN(s[i])&&!isNaN(o[i]))return e==="ascending"?s[i]-o[i]:o[i]-s[i];let r=e==="ascending"?s[i].toUpperCase():o[i].toUpperCase(),a=e==="ascending"?o[i].toUpperCase():s[i].toUpperCase();switch(!0){case r>a:return 1;case r<a:return-1;case r===a:return 0}})}this.renderBody()}}#e(t,e){let i=this.querySelector(`.dg-head-columns th[field=${t}]`),s=e==="ascending"?"none":e==="descending"?"ascending":"descending";i?.setAttribute("aria-sort",s),this.sortData(i)}sortAsc=t=>this.#e(t,"ascending");sortDesc=t=>this.#e(t,"descending");sortNone=t=>this.#e(t,"none");fetchData(){if(!this.options.url)return new Promise((s,o)=>o("No url set"));let t=window.location.href;t.split("/").pop().includes(".")||(t+=t.endsWith("/")?"":"/");let e=new URL(this.options.url,t),i={r:Date.now()};return this.options.server&&(i[this.options.serverParams.start]=this.page-1,i[this.options.serverParams.length]=this.options.perPage,this.options.filter&&(i[this.options.serverParams.search]=this.getFilters()),i[this.options.serverParams.sort]=this.getSort()||"",i[this.options.serverParams.sortDir]=this.getSortDir(),this.meta?.[this.options.serverParams.paramsKey]&&(i=Object.assign(i,this.meta[this.options.serverParams.paramsKey]))),J(e,i),fetch(e).then(s=>{if(!s.ok)throw new Error(s.statusText||C.networkError);return s.json()})}renderTable(){this.log("render table"),this.options.menu&&this.plugins.ContextMenu&&this.plugins.ContextMenu.createMenu();let t;this.renderHeader(),this.options.defaultSort&&(t=this.querySelector("thead tr.dg-head-columns th[field='"+this.options.defaultSort+"']")),t?this.sortData(t):this.renderBody(),this.renderFooter()}renderHeader(){this.log("render header");let t=this.querySelector("thead");this.createColumnHeaders(t),this.createColumnFilters(t),this.options.resizable&&this.plugins.ColumnResizer&&this.plugins.ColumnResizer.renderResizer(C.resizeColumn),x(this,"headerRendered")}renderFooter(){this.log("render footer");let t=this.querySelector("tfoot"),e=t.querySelector("td");t.removeAttribute("hidden"),h(e,"colspan",this.columnsLength(!0)),t.style.display=""}createColumnHeaders(t){let e=this.clientWidth,i=Math.round(e/this.columnsLength(!0)*2),s=0,o;o=y("tr"),this.headerRow=o,o.setAttribute("role","row"),o.setAttribute("aria-rowindex","1"),o.setAttribute("class","dg-head-columns");let r=t.querySelector("tr.dg-head-columns th");r||(r=y("th"),t.querySelector("tr").appendChild(r)),this.options.selectable&&this.plugins.SelectableRows&&this.plugins.SelectableRows.createHeaderCol(o),this.options.responsive&&this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.hasHiddenColumns()&&this.plugins.ResponsiveGrid.createHeaderCol(o),s=0;let a=0;if(this.options.columns.forEach(l=>{if(l.attr)return;let c=s+this.startColIndex(),d=y("th");d.setAttribute("scope","col"),d.setAttribute("role","columnheader button"),d.setAttribute("aria-colindex",""+c),d.setAttribute("id",M("dg-col-")),this.options.sort&&d.setAttribute("aria-sort","none"),d.setAttribute("field",l.field),this.plugins.ResponsiveGrid&&this.options.responsive&&h(d,"data-responsive",l.responsive||"");let u=z(l.title,r,!0)+20;d.dataset.minWidth=""+u,vt(d,l),d.tabIndex=0,d.textContent=l.title;let g=0;if(this.options.autosize&&this.plugins.AutosizeColumn){let b=Math.min(e-a,i);g=this.plugins.AutosizeColumn.computeSize(d,l,parseInt(d.dataset.minWidth),b)}else g=Math.max(parseInt(d.dataset.minWidth),parseInt(d.getAttribute("width")));h(d,"width",g),l.hidden?d.setAttribute("hidden",""):a+=g,this.options.reorder&&this.plugins.DraggableHeaders&&this.plugins.DraggableHeaders.makeHeaderDraggable(d),o.appendChild(d),s++}),a<e){let l=f(o,"th:not([hidden],.dg-not-resizable)");if(l.length){let c=l[l.length-1];E(c,"width")}}if(this.options.actions.length&&this.plugins.RowActions&&this.plugins.RowActions.makeActionHeader(o),t.replaceChild(o,t.querySelector("tr.dg-head-columns")),t.offsetWidth>e){this.log(`adjust width to fix size, ${t.offsetWidth} > ${e}`);let l=this.offsetWidth-this.clientWidth,c=t.offsetWidth-e-l;this.options.responsive&&this.plugins.ResponsiveGrid&&(c+=l),f(o,"th[width]").forEach(u=>{if(I(u,"dg-not-resizable")||c<=0)return;let g=parseInt(u.getAttribute("width")),b=u.dataset.minWidth?parseInt(u.dataset.minWidth):0;if(g>b){let v=g-c;v<b&&(v=b),c-=g-v,h(u,"width",v)}})}this.options.menu&&this.plugins.ContextMenu&&this.plugins.ContextMenu.attachContextMenu(),o.querySelectorAll("[aria-sort]").forEach(l=>{l.addEventListener("click",()=>this.sortData(l))}),h(this.querySelector("table"),"aria-colcount",this.columnsLength(!0))}createColumnFilters(t){let e=0,i;i=y("tr"),this.filterRow=i,i.setAttribute("role","row"),i.setAttribute("aria-rowindex","2"),i.setAttribute("class","dg-head-filters"),this.options.filter||i.setAttribute("hidden",""),this.options.selectable&&this.plugins.SelectableRows&&this.plugins.SelectableRows.createFilterCol(i),this.options.responsive&&this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.hasHiddenColumns()&&this.plugins.ResponsiveGrid.createFilterCol(i),this.options.columns.forEach(s=>{if(s.attr)return;let o=e+this.startColIndex(),r=t.querySelector("tr.dg-head-columns th[aria-colindex='"+o+"']");if(!r){console.warn("Related th not found",o);return}let a=y("th");a.setAttribute("aria-colindex",""+o);let l=this.createFilterElement(s,r);this.options.filter?l.tabIndex=0:a.tabIndex=0,s.hidden&&a.setAttribute("hidden",""),a.appendChild(l),i.appendChild(a),e++}),this.options.actions.length&&this.plugins.RowActions&&this.plugins.RowActions.makeActionFilter(i),t.replaceChild(i,t.querySelector("tr.dg-head-filters")),(typeof this.options.filterKeypressDelay!="number"||this.options.filterOnEnter)&&(this.options.filterKeypressDelay=0),i.querySelectorAll(this.#t).forEach(s=>{let o=/select/i.test(s.tagName)?"change":"keyup",r=B(a=>{let l=a.keyCode||a.key,c=!this.options.filterOnEnter&&!this.#i.some(d=>d==l);(l===13||l==="Enter"||c||a.type=="change")&&this.filterData.call(this)},this.options.filterKeypressDelay);s.addEventListener(o,r)})}createFilterElement(t,e){let i=t.filterType=="select",s=i?y("select"):y("input");if(i){if(!Array.isArray(t.filterList)){let o=[...new Set((this.data??[]).map(r=>r[t.field]))].filter(r=>r).sort();t.filterList=[t.firstFilterOption||this.defaultColumn.firstFilterOption].concat(o.map(r=>({value:r,text:r})))}t.filterList.forEach(o=>{let r=y("option");r.value=o.value,r.text=o.text,s.add(r)})}else s.type="text",s.inputMode="search",s.autocomplete="off",s.spellcheck=!1;return s.dataset.name=t.field,s.id=M("dg-filter-"),s.setAttribute("aria-labelledby",e.getAttribute("id")),s}renderBody(){this.log("render body");let t,e,i,s=y("tbody");this.data.forEach((r,a)=>{t=y("tr"),h(t,"role","row"),h(t,"hidden",""),h(t,"aria-rowindex",a+1),t.tabIndex=0,this.options.selectable&&this.plugins.SelectableRows&&this.plugins.SelectableRows.createDataCol(t),this.options.responsive&&this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.hasHiddenColumns()&&this.plugins.ResponsiveGrid.createDataCol(t),this.options.expand&&(t.classList.add("dg-expandable"),w(t,"click",l=>{this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.blockObserver(),ft(l.currentTarget,"dg-expanded"),this.plugins.ResponsiveGrid&&this.plugins.ResponsiveGrid.unblockObserver()})),i=0,this.options.columns.forEach(l=>{if(l||console.error("Empty column found!",this.options.columns),l.attr){r[l.field]&&(l.attr==="class"?L(t,r[l.field]):t.setAttribute(l.attr,r[l.field]));return}if(e=y("td"),e.setAttribute("role","gridcell"),e.setAttribute("aria-colindex",i+this.startColIndex()),vt(e,l),e.setAttribute("data-name",l.title),e.tabIndex=-1,l.editable&&this.plugins.EditableColumn)L(e,"dg-editable-col"),this.plugins.EditableColumn.makeEditableInput(e,l,r,a);else{let c=r[l.field]??"",d;switch(l.transform){case"uppercase":d=c.toUpperCase();break;case"lowercase":d=c.toLowerCase();break;default:d=c;break}if(l.format){if(l.defaultFormatValue!=null&&(d===""||d===null)&&(d=l.defaultFormatValue+""),typeof l.format=="string"&&d)e.innerHTML=N(l.format,Object.assign({_v:c,_tv:d},r));else if(l.format instanceof Function){let u=l.format.call(this,{column:l,rowData:r,cellData:d,td:e,tr:t});e.innerHTML=u||d||c}}else e.textContent=d}t.appendChild(e),i++}),this.options.actions.length&&this.plugins.RowActions&&this.plugins.RowActions.makeActionRow(t,r),s.appendChild(t)}),s.setAttribute("role","rowgroup");let o=this.querySelector("tbody");s.setAttribute("data-empty",o.getAttribute("data-empty")),this.querySelector("table").replaceChild(s,o),this.plugins.FixedHeight&&this.plugins.FixedHeight.createFakeRow(),this.paginate(),this.plugins.SelectableRows&&this.plugins.SelectableRows.shouldSelectAll(s),this.data.length&&this.classList.remove("dg-empty"),x(this,"bodyRendered")}paginate(){this.log("paginate");let t=this.totalRecords(),e=this.page||1,i,s=e*this.options.perPage,o=s-this.options.perPage+1,r=this.querySelector("tbody"),a=this.querySelector("tfoot");s>t&&(s=t),t||(o=0),r.querySelectorAll("tr").forEach(l=>{if(this.options.server){E(l,"hidden");return}i=Number(k(l,"aria-rowindex")),i>s||i<o?h(l,"hidden",""):E(l,"hidden")}),this.options.selectable&&this.plugins.SelectableRows&&this.plugins.SelectableRows.clearCheckboxes(r),this.plugins.FixedHeight&&this.plugins.FixedHeight.updateFakeRow(),this.btnFirst&&(this.btnFirst.disabled=this.page<=1,this.btnPrev.disabled=this.page<=1,this.btnNext.disabled=this.page>=this.pages,this.btnLast.disabled=this.page>=this.pages),a.querySelector(".dg-low").textContent=o.toString(),a.querySelector(".dg-high").textContent=s.toString(),a.querySelector(".dg-total").textContent=""+this.totalRecords(),a.toggleAttribute("hidden",this.options.autohidePager&&this.options.perPage>this.totalRecords())}totalPages(){return Math.ceil(this.totalRecords()/this.options.perPage)}totalRecords(){return this.options.server?this.meta?.[this.options.serverParams.metaFilteredKey]||0:this.data.length}},U=Q;var tt=class{constructor(t){this.grid=t}connected(){}disconnected(){}handleEvent(t){this[`on${t.type}`]&&this[`on${t.type}`](t)}},m=tt;var et=class extends m{constructor(t){super(t),this.isResizing=!1}renderResizer(t){let e=this.grid,i=e.table,s=f(e,"thead tr.dg-head-columns th");s.forEach(o=>{if(I(o,"dg-not-resizable"))return;let r=document.createElement("div");L(r,"dg-resizer"),r.ariaLabel=t,o.appendChild(r);let a=0,l=0,c=0,d=0,u=b=>{if(b.clientX>d)return;let v=l+(b.clientX-a);o.dataset.minWidth&&v>parseInt(o.dataset.minWidth)&&h(o,"width",v)},g=()=>{e.log("resized column"),setTimeout(()=>{this.isResizing=!1},0),q(r,"dg-resizer-active"),e.options.reorder&&(o.draggable=!0),o.style.overflow="hidden",H(document,"mousemove",u),H(document,"mouseup",g),x(e,"columnResized",{col:k(o,"field"),width:k(o,"width")})};w(r,"click",b=>{b.stopPropagation()}),w(r,"mousedown",b=>{b.stopPropagation(),this.isResizing=!0;let v=b.target,P=f(e,"dg-head-columns th").filter(p=>!p.hasAttribute("hidden")),A=P.findIndex(p=>p==v.parentNode);e.log("resize column"),L(r,"dg-resizer-active"),E(o,"draggable"),o.style.overflow="visible",r.style.height=i.offsetHeight-1+"px",a=b.clientX,l=o.offsetWidth,c=(P.length-A)*30,d=Z(v).left+e.offsetWidth-c,h(o,"width",l);for(let p=0;p<P.length;p++)p>A&&E(s[p],"width");w(document,"mousemove",u),w(document,"mouseup",g)})})}},yt=et;function j(n,t,e="nodeName"){let i=n;for(;i[e]!=t;)i=i.parentElement;return i}var it=class extends m{connected(){this.menu=this.grid.querySelector(".dg-menu")}disconnected(){this.grid.headerRow&&H(this.grid.headerRow,"contextmenu",this)}attachContextMenu(){let t=this.grid;w(t.headerRow,"contextmenu",this)}onchange(t){let e=this.grid,i=t.target,s=i.dataset.name;if(i.checked)e.showColumn(s);else{if(e.visibleColumns().length<=1){i.checked=!0;return}e.hideColumn(s)}e.fixPage()}oncontextmenu(t){t.preventDefault();let e=this.grid,i=j(t.target,"THEAD"),s=this.menu,o=i.getBoundingClientRect(),r=t.clientX-o.left,a=t.clientY-o.top;s.style.top=`${a}px`,s.style.left=`${r}px`,E(s,"hidden"),r+150>o.width&&(r-=s.offsetWidth,s.style.left=`${r}px`);let l=c=>{s.contains(c.target)||(h(s,"hidden",""),H(document,"click",l))};w(document,"click",l)}createMenu(){let t=this.grid,e=this.menu;for(;e.lastChild;)e.removeChild(e.lastChild);e.addEventListener("change",this),t.options.columns.forEach(i=>{if(i.attr)return;let s=document.createElement("li"),o=document.createElement("label"),r=document.createElement("input");h(r,"type","checkbox"),h(r,"data-name",i.field),i.hidden||(r.checked=!0);let a=document.createTextNode(i.title);o.appendChild(r),o.appendChild(a),s.appendChild(o),e.appendChild(s)})}},xt=it;var st=class extends m{makeHeaderDraggable(t){let e=this.grid;t.draggable=!0,w(t,"dragstart",i=>{if(e.plugins.ColumnResizer&&e.plugins.ColumnResizer.isResizing&&i.preventDefault){i.preventDefault();return}e.log("reorder col"),i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("text/plain",i.target.getAttribute("aria-colindex"))}),w(t,"dragover",i=>(i.preventDefault&&i.preventDefault(),i.dataTransfer.dropEffect="move",!1)),w(t,"drop",i=>{i.stopPropagation&&i.stopPropagation();let s=i.target,o=j(s,"TH"),r=parseInt(i.dataTransfer.getData("text/plain")),a=parseInt(o.getAttribute("aria-colindex"));if(r===a){e.log("reordered col stayed the same");return}e.log("reordered col from "+r+" to "+a);let l=e.startColIndex(),c=e.options.columns[r-l];e.options.columns[r-l]=e.options.columns[a-l],e.options.columns[a-l]=c;let d=(u,g)=>{let b=g.parentNode.getAttribute("aria-rowindex"),v=e.querySelector(u+" tr[aria-rowindex='"+b+"'] [aria-colindex='"+a+"']");h(g,"aria-colindex",a),h(v,"aria-colindex",r);let R=document.createElement("th");g.parentNode.insertBefore(R,g),v.parentNode.replaceChild(g,v),R.parentNode.replaceChild(v,R)};return f(e,"thead th[aria-colindex='"+r+"']").forEach(u=>{d("thead",u)}),f(e,'tbody td[aria-colindex="'+r+'"]').forEach(u=>{d("tbody",u)}),e.options.columns=f(e,"thead tr.dg-head-columns th[field]").map(u=>e.options.columns.find(g=>g.field==k(u,"field"))),x(e,"columnReordered",{col:c.field,from:r,to:a}),!1})}},Ct=st;var rt=class extends m{constructor(t){super(t),this.touch=null}connected(){let t=this.grid;t.addEventListener("touchstart",this,{passive:!0}),t.addEventListener("touchmove",this,{passive:!0})}disconnected(){let t=this.grid;t.removeEventListener("touchstart",this),t.removeEventListener("touchmove",this)}ontouchstart(t){this.touch=t.touches[0]}ontouchmove(t){if(!this.touch)return;let e=this.grid,i=this.touch.clientX-t.touches[0].clientX,s=this.touch.clientY-t.touches[0].clientY;Math.abs(i)>Math.abs(s)&&(i>0?e.getNext():e.getPrev()),this.touch=null}},At=rt;var O="dg-selectable",Pt="dg-select-all",wt="form-check-input",ot=class extends m{disconnected(){this.selectAll&&this.selectAll.removeEventListener("change",this)}getSelection(t=null){let e=this.grid,i=[];return f(e,`tbody .${O} input:checked`).forEach(o=>{let r=parseInt(o.dataset.id),a=e.data[r-1];a||console.warn(`Item ${r} not found`),t?i.push(a[t]):i.push(a)}),i}clearCheckboxes(t){if(!this.grid.options.selectVisibleOnly)return;f(t,`tr[hidden] .${O} input`).forEach(s=>{s.checked=!1}),this.selectAll.checked=!1}colIndex(){return this.grid.startColIndex()-2}createHeaderCol(t){let e=document.createElement("th");h(e,"scope","col"),h(e,"role","columnheader button"),h(e,"aria-colindex",this.colIndex()),e.classList.add(O,"dg-not-resizable","dg-not-sortable"),e.tabIndex=0,this.selectAll=document.createElement("input"),this.selectAll.type="checkbox",this.selectAll.classList.add(Pt),this.selectAll.classList.add(wt),this.selectAll.addEventListener("change",this);let i=document.createElement("label");i.appendChild(this.selectAll),e.appendChild(i),e.setAttribute("width","40"),t.appendChild(e)}createFilterCol(t){let e=document.createElement("th");h(e,"role","columnheader button"),h(e,"aria-colindex",this.colIndex()),e.classList.add(O),e.tabIndex=0,t.appendChild(e)}shouldSelectAll(t){this.selectAll&&(t.addEventListener("change",this),t.dispatchEvent(new Event("change")))}createDataCol(t){let e=document.createElement("td");h(e,"role","gridcell button"),h(e,"aria-colindex",this.colIndex()),e.classList.add(O);let i=document.createElement("input");i.dataset.id=t.getAttribute("aria-rowindex"),i.type="checkbox",i.classList.add(wt);let s=document.createElement("label");s.classList.add("dg-clickable-cell"),s.appendChild(i),e.appendChild(s),s.addEventListener("click",this),t.appendChild(e)}onclick(t){t.stopPropagation()}onchange(t){let e=this.grid;if(I(t.target,Pt)){let i=e.options.selectVisibleOnly;f(e,`tbody .${O} input`).forEach(o=>{i&&!o.offsetWidth||(o.checked=this.selectAll.checked)}),x(e,"rowsSelected",{selection:this.getSelection()})}else{if(!t.target.closest(`.${O}`))return;let i=f(e,`tbody .${O} input[type=checkbox]`),s=i.filter(o=>o.checked);this.selectAll.checked=s.length==i.length,x(e,"rowsSelected",{selection:e.getSelection()})}}},St=ot;var nt=class extends m{constructor(t){super(t),this.hasFixedHeight=!1,t.style.height&&(t.style.overflowY="auto",this.hasFixedHeight=!0)}createFakeRow(){let e=this.grid.querySelector("tbody"),i=document.createElement("tr");h(i,"role","row"),h(i,"hidden",""),i.classList.add("dg-fake-row"),i.tabIndex=0,e.appendChild(i)}get fakeRow(){return this.grid.querySelector(".dg-fake-row")}updateFakeRow(){let t=this.grid,e=this.fakeRow;if(!e||t.options.perPage>t.totalRecords()||t.page!==t.totalPages()||!t.options.autoheight)return;let i=t.options.perPage*t.rowHeight,s=t.querySelectorAll("tbody tr:not([hidden])").length,o=s>1?i-s*t.rowHeight:i;o>0?(h(e,"height",o),e.removeAttribute("hidden")):e.removeAttribute("height")}},Et=nt;var at=class extends m{computeSize(t,e,i,s){let o=this.grid;if(K(t,"width"))return k(t,"width");if(!o.data.length)return;let r=o.data[0],a=o.data[o.data.length-1],l=r[e.field]?r[e.field].toString():"",c=a[e.field]?a[e.field].toString():"";c.length>l.length&&(l=c);let d=0;return l.length<=6?d=i:l.length>50?d=s:d=z(l+"0000",t),d>s&&(d=s),d<i&&(d=i),h(t,"width",d),d}},Lt=at;var S="dg-responsive",lt;function Ht(n){return n.sort((t,e)=>{let i=parseInt(t.dataset.responsive)||1;return(parseInt(e.dataset.responsive)||1)-i})}var Wt=B(n=>{for(let t of n){let e=t.target,i=e.table;if(e.plugins.ResponsiveGrid.observerBlocked)return;let s=Array.isArray(t.contentBoxSize)?t.contentBoxSize[0]:t.contentBoxSize,o=parseInt(s.inlineSize),r=i.offsetWidth,a=f(e.headerRow,"th").reduce((P,A)=>P+A.offsetWidth,0),l=(a||r)-o-1,c=50,d=e.plugins.ResponsiveGrid.prevAction,u=Ht(f(e.headerRow,"th[field]").reverse().filter(P=>P.dataset.responsive!=="0")),g=!1;if(e.log(`table is ${r}/${a} and available size is ${o}. Diff: ${l}`),l>0){if(d==="show")return;e.plugins.ResponsiveGrid.prevAction="hide";let P=l,A=u.filter(p=>!p.hasAttribute("hidden")&&p.hasAttribute("data-responsive"));if(A.length===0&&(A=u.filter(p=>!p.hasAttribute("hidden")),A.length===1))return;A.forEach(p=>{if(P<0)return;let $=p.offsetWidth,D=p.getAttribute("field");D&&(p.dataset.baseWidth=""+p.offsetWidth,e.hideColumn(D,!1),e.setColProp(D,"responsiveHidden",!0),g=!0,P-=$,P=Math.round(P))})}else{if(d==="hide")return;e.plugins.ResponsiveGrid.prevAction="show";let P=u.filter(p=>!p.hasAttribute("hidden")).reduce((p,$)=>{let D=$.dataset.minWidth?parseInt($.dataset.minWidth):$.offsetWidth;return p+D},0)+c,A=o-P;u.slice().reverse().filter(p=>p.hasAttribute("hidden")).forEach(p=>{if(A<c)return;let $=parseInt(p.dataset.minWidth);if($>A){A=-1;return}let D=p.getAttribute("field");D&&(e.showColumn(D,!1),e.setColProp(D,"responsiveHidden",!1),g=!0,A-=$,A=Math.round(A))})}let b=T(e.table,"tfoot"),v=f(e.table,".dg-footer > div").reduce((P,A)=>P+A.offsetWidth,0),R=b.offsetWidth-v;v>o?L(b,"dg-footer-compact"):R>250&&q(b,"dg-footer-compact"),g&&e.renderTable(),setTimeout(()=>{e.plugins.ResponsiveGrid.prevAction=null},1e3),e.table.style.visibility="visible"}},100),kt=new ResizeObserver(Wt),dt=class extends m{constructor(t){super(t),this.observerBlocked=!1,this.prevAction=null}connected(){this.grid.options.responsive&&this.observe()}disconnected(){this.unobserve()}observe(){this.grid.options.responsive&&(kt.observe(this.grid),this.grid.style.display="block",this.grid.style.overflowX="hidden")}unobserve(){kt.unobserve(this.grid),this.grid.style.display="unset",this.grid.style.overflowX="unset"}blockObserver(){this.observerBlocked=!0,lt&&clearTimeout(lt)}unblockObserver(){lt=setTimeout(()=>{this.observerBlocked=!1},200)}hasHiddenColumns(){let t=!1;return this.grid.options.columns.forEach(e=>{e.responsiveHidden&&(t=!0)}),t}colIndex(){return this.grid.startColIndex()-1}createHeaderCol(t){if(!this.grid.options.responsiveToggle)return;let e=y("th",t);h(e,"scope","col"),h(e,"role","columnheader button"),h(e,"aria-colindex",this.colIndex()),h(e,"width","40"),e.classList.add(`${S}-toggle`,"dg-not-resizable","dg-not-sortable"),e.tabIndex=0}createFilterCol(t){if(!this.grid.options.responsiveToggle)return;let e=y("th",t);h(e,"role","columnheader button"),h(e,"aria-colindex",this.colIndex()),e.classList.add(`${S}-toggle`),e.tabIndex=0}createDataCol(t){if(!this.grid.options.responsiveToggle)return;let e=document.createElement("td");h(e,"role","gridcell button"),h(e,"aria-colindex",this.colIndex()),e.classList.add(`${S}-toggle`),e.innerHTML=`<div class='dg-clickable-cell'><svg class='${S}-open' viewbox="0 0 24 24" height="24" width="24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
</svg>
<svg class='${S}-close' viewbox="0 0 24 24" height="24" width="24" style="display:none">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
</svg></div>`,t.appendChild(e),e.addEventListener("click",this),e.addEventListener("mousedown",this)}computeLabelWidth(){let t=0,e=0;for(;t<120;){e++;let i=T(this.grid,`.dg-head-columns th[aria-colindex="${e}"]`);if(i)t+=i.offsetWidth;else break}return t}onmousedown(t){t.preventDefault()}onclick(t){t.stopPropagation();let e=t.currentTarget,i=e.parentElement,s=T(e,`.${S}-open`),o=T(e,`.${S}-close`);if(this.blockObserver(),I(i,`${S}-expanded`)){q(i,`${S}-expanded`),s.style.display="unset",o.style.display="none";let a=i.nextElementSibling;f(a,`.${S}-hidden`).forEach(c=>{i.appendChild(c),h(c,"hidden")}),a.parentElement.removeChild(a)}else{L(i,`${S}-expanded`),s.style.display="none",o.style.display="unset";let a=y("tr");mt(a,i),L(a,`${S}-child-row`);let l=y("td",a);h(l,"colspan",this.grid.columnsLength(!0));let c=y("table",l);L(c,`${S}-table`);let d=f(i,`.${S}-hidden`),u=this.computeLabelWidth();d.forEach(g=>{let b=y("tr",c),v=g.dataset.name,R=y("th",b);R.style.width=`${u}px`,R.innerHTML=v,b.appendChild(g),E(g,"hidden")})}this.unblockObserver()}},Rt=dt;var ht=class extends m{hasActions(){return this.grid.options.actions.length>0}makeActionHeader(t){let e=document.createElement("th");h(e,"role","columnheader button"),h(e,"aria-colindex",this.grid.columnsLength(!0)),e.classList.add("dg-actions","dg-not-sortable","dg-not-resizable",this.actionClass),e.tabIndex=0,t.appendChild(e)}makeActionFilter(t){let e=document.createElement("th");e.setAttribute("role","columnheader button"),e.setAttribute("aria-colindex",""+this.grid.columnsLength(!0)),e.classList.add("dg-actions",this.actionClass),e.tabIndex=0,t.appendChild(e)}makeActionRow(t,e){let i=this.grid.labels,s=document.createElement("td");h(s,"role","gridcell"),h(s,"aria-colindex",this.grid.columnsLength(!0)),s.classList.add("dg-actions",this.actionClass),s.tabIndex=0;let o=document.createElement("button");o.classList.add("dg-actions-toggle"),o.innerHTML="\u2630",s.appendChild(o),w(o,"click",r=>{r.stopPropagation(),r.target.parentElement.classList.toggle("dg-actions-expand")}),this.grid.options.actions.forEach(r=>{let a=document.createElement("button");r.html?a.innerHTML=r.html:a.innerText=r.title??r.name,r.title&&(a.title=r.title),r.url&&(a.type="submit",a.formAction=N(r.url,e)),r.class&&a.classList.add(...r.class.split(" "));let l=c=>{if(c.stopPropagation(),r.confirm&&!confirm(i.areYouSure)){c.preventDefault();return}x(this.grid,"action",{data:e,action:r.name})};a.addEventListener("click",l),s.appendChild(a),r.default&&(t.classList.add("dg-actionable"),t.addEventListener("click",l))}),t.appendChild(s)}get actionClass(){return this.grid.options.actions.length<3&&!this.grid.options.collapseActions?"dg-actions-"+this.grid.options.actions.length:"dg-actions-more"}},Dt=ht;var ct=class extends m{makeEditableInput(t,e,i,s){let o=this.grid.getAttribute("id"),r=document.createElement("input");r.type=e.editableType||"text",r.type=="email"&&(r.inputMode="email"),r.type=="decimal"&&(r.type="text",r.inputMode="decimal"),r.autocomplete="off",r.spellcheck=!1,r.tabIndex=0,r.classList.add("dg-editable"),r.name=o.replace("-","_")+"["+(s+1)+"]["+e.field+"]",r.value=i[e.field],r.dataset.field=e.field,r.addEventListener("click",a=>a.stopPropagation()),r.addEventListener("keypress",a=>{if(a.type==="keypress"){let l=a.keyCode||a.key;(l===13||l==="Enter")&&(r.blur(),a.preventDefault())}}),r.addEventListener("blur",()=>{r.value!=i[r.dataset.field]&&(i[r.dataset.field]=r.value,x(this.grid,"edit",{data:i,value:r.value}))}),t.appendChild(r)}},$t=ct;var ut=class extends m{add(){let t=this.grid,e=t.options.spinnerClass;if(!e)return;let i=e.split(" ").map(o=>`.${o}`).join(""),s=`
<style id="dg-styles">
  data-grid ${i} { position: absolute; top: 37%; left: 47%; z-index: 999; }
  data-grid:not(.dg-loading) ${i} { display: none; }
  data-grid:not(.dg-initialized).dg-loading ${i} { top: 0; }
  @media only screen and (max-width: 767px) {
    data-grid[responsive] ${i} { top: 8rem; left: 42%; } 
  }
</style>
`;if(!W("#dg-styles")){let o=W("head")??W("body"),r=/head/i.test(o.tagName)?"beforeend":"afterbegin";o.insertAdjacentHTML(r,s)}!W(`i${i}`,t)&&t.insertAdjacentHTML("afterbegin",`<i class="${e}"></i>`)}},It=ut;var gt=class extends m{constructor(t){super(t),this.cachedState=null,this.isFilterSortSet=!1,this.isDataLoaded=!1,this.isScrolled=!1,this.log("Init")}connected(){this.log("connected");let t=this.grid;if(!t.options.saveState)return;this.log("enabled");let e=this._getState();e&&(this.log("hide columns"),e.columns.forEach(o=>{if(o.hidden){let r=t.options.columns.find(a=>a.field==o.field);r.hidden=!0}}),this.log("set: meta, pages"),t.options.perPage=e.perPage,t.options.server&&(t.meta=e.meta,t.pages=e.pages,t.page=e.page)),this.cachedState=e;let i=t.loadData;t.loadData=function(){return new Promise((o,r)=>{i.apply(this,arguments).finally(()=>{let a=this.plugins.SaveState;if(!t.classList.contains("dg-initialized"))return a.log("not init, loadData skipped"),o();a.log("loadData finished, set param controls"),a.cachedState&&!a.isFilterSortSet&&(a.log("set sort and filters"),t.querySelectorAll("thead tr.dg-head-columns th[aria-sort]").forEach(d=>{d.setAttribute("aria-sort","none")}),t.querySelector(`thead tr.dg-head-columns th[field='${a.cachedState.sort}']`)?.setAttribute("aria-sort",a.cachedState.sortDir),t.filterRow.querySelectorAll("[id^=dg-filter]").forEach(d=>{d.value=a.cachedState.filters[d.dataset.name]}),a.isFilterSortSet=!0);let l={meta:t.meta,pages:t.pages,page:t.page,perPage:t.options.perPage,filters:{},columns:t.options.columns.map(d=>({field:d.field,hidden:d.hidden})),sort:t.getSort(),sortDir:t.getSortDir(),scrollTo:window.scrollY},c=t.getFilters();Object.keys(c).forEach(d=>{l.filters[d]=c[d]}),a.log("store new state"),a._setState(l),!t.options.server&&a.cachedState&&!a.isDataLoaded&&(a.isDataLoaded=!0,t.filterData(),t.page=a.cachedState.page,t.pageChanged()),o()})})};let s=()=>{let o=t.plugins.SaveState,r=o._getState();r&&(r.columns=t.options.columns.map(a=>({field:a.field,hidden:a.hidden})),r.sort=t.getSort(),r.sortDir=t.getSortDir(),r.scrollTo=window.scrollY,o._setState(r))};document.addEventListener("scrollend",s),t.addEventListener("headerRendered",s),t.addEventListener("bodyRendered",function(o){if(!t.classList.contains("dg-initialized")||t.classList.contains("dg-loading"))return;t.options.server||s();let r=t.plugins.SaveState;!r.cachedState||!r.isFilterSortSet||(r.isDataLoaded?r.isScrolled||(r.isScrolled=!0,window.scrollTo({top:r.cachedState.scrollTo,left:0,behavior:"instant"})):(r.isDataLoaded=!0,t.reload()))})}log(t){this.grid.log(`[Save-State] ${t}`)}_getState(){let t;try{t=JSON.parse(sessionStorage.getItem(`gridSaveState_${this.grid.id}`))}catch{}return t}_setState(t){sessionStorage.setItem(`gridSaveState_${this.grid.id}`,JSON.stringify(t))}},Tt=gt;U.registerPlugins({ColumnResizer:yt,ContextMenu:xt,DraggableHeaders:Ct,TouchSupport:At,SelectableRows:St,FixedHeight:Et,AutosizeColumn:Lt,ResponsiveGrid:Rt,RowActions:Dt,EditableColumn:$t,SpinnerSupport:It,SaveState:Tt});customElements.get("data-grid")||customElements.define("data-grid",U);var pi=U;export{pi as default};
/**
 * Data Grid custom element
 * https://github.com/lekoala/data-grid/
 * @license MIT
 */
//# sourceMappingURL=data-grid.min.js.map
